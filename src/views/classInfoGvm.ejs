<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/gvmList.css">

    <style>
        .teacher-group {
          border: 2px solid black; /* Vi·ªÅn ƒëen xung quanh nh√≥m gi·∫£ng vi√™n */
          border-collapse: separate;
          margin-bottom: 10px;
        }
        .teacher-group td, .teacher-group th {
          padding: 8px;
          text-align: left;
          border: 2px solid black; /* Vi·ªÅn ƒëen xung quanh nh√≥m gi·∫£ng vi√™n */

        }
      </style>
</head>
<body>
        <nav class="navbar-top ">
          <div class="container-fluid">
              <a class="navbar-brand" href="#">
                  <img src="/Logo-Hoc-Vien-Ky-Thuat-Mat-Ma-ACTVN.webp" alt="Logo">
                  <div class="navbar-title">
                    <img src="/dongchu_banner.png" alt="banner">
                  </div>
              </a>
          </div>
      </nav>
      
      <!-- Ph·∫ßn d∆∞·ªõi c·ªßa navbar ch·ª©a c√°c m·ª•c n·∫±m ngang -->
      <nav class="navbar navbar-expand-lg navbar-bottom sticky-top">
          <div class="container-fluid">
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                  <ul class="navbar-nav">
                    <li class="nav-item">
                      <a class="nav-link" href="/mainkhoa">HOME</a>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" onclick="ThongTinGD()" href="">Th√¥ng tin GD</a>
                    </li>
                    <!-- <li> -->
                    <li class="nav-item"> 
                      <!-- <a class="nav-link" href="/import">Import danh s√°ch gi·∫£ng vi√™n m·ªùi</a> -->
                      <a class="nav-link" onclick="Import()" href="">Import</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="/daotaoxemhd" role="button">Xem h·ª£p ƒë·ªìng</a>
                    </li> -->
      
                    <!-- Danh s√°ch gi·∫£ng vi√™n m·ªùi -->
                    <li class="nav-item"></li>
                        <a  class="nav-link" href="/gvmList" role="button">Danh s√°ch gi·∫£ng vi√™n m·ªùi</a>
                    </li>
      
                    <!-- Th√¥ng tin c√°c l·ªõp gi·∫£ng vi√™n m·ªùi -->
                    <li class="nav-item"></li>
                        <a  class="nav-link active" href="/classInfoGvm" role="button">Th√¥ng tin c√°c l·ªõp gi·∫£ng vi√™n m·ªùi</a>
                    </li>
                      <div class="navbar-nav">
                        <div class="nav-item dropdown">
                              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                                Hi, L√™ ƒê·ª©c Thu·∫≠n
                              </a>
                              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                  <a class="dropdown-item" href="#">Th√¥ng tin c√° nh√¢n</a>
                                  <a class="dropdown-item" href="/">ƒêƒÉng xu·∫•t</a>
                              </div>
                        </div>
                  </ul>
              </div>
          </div>
        </nav>

    <div class="container-fluid ">
             <div class="d-flex justify-content-center">
                <!-- Main content -->
                <div class="gvmList ">
                    <div class="m-3">
                        <div class="container">
                            <h1>TH√îNG TIN C√ÅC L·ªöP GI·∫¢NG VI√äN M·ªúI</h1>
                            <div class="header-actions">
                              <!-- <button class="add-class" onclick="addClass()">+ Th√™m gi·∫£ng vi√™n m·ªùi</button> -->
                              <input
                                type="text"
                                placeholder="T√¨m ki·∫øm theo T√™n..."
                                class="search"
                                id="searchInput"
                                onkeyup="searchClass()"
                              />
                              <select class="filter" onchange="filterClasses()">
                                <option value="">C√¥ng ngh·ªá th√¥ng tin</option>
                                <option value="">An to√†n th√¥ng tin</option>
                                <option value="">ƒêi·ªán t·ª≠ vi·ªÖn th√¥ng</option>
                                <option value="">M·∫≠t m√£</option>
                                <!-- C√°c t√πy ch·ªçn l·ªçc kh√°c -->
                              </select>
                            </div>
                            
                            <table class="class-table" id="classTable">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Gi·∫£ng vi√™n</th>
                                        <th>M√¥n h·ªçc</th>
                                        <th>T√™n l·ªõp</th>
                                        <th>S·ªë t√≠n ch·ªâ</th>
                                        <th>S·ªë ti·∫øt</th>
                                        <th>T·ªïng s·ªë ti·∫øt</th>
                                        <th>Chi ti·∫øt gi·∫£ng vi√™n m·ªùi</th>
                                    </tr>
                                </thead>
                                <tbody class="teacher-group">

                                    <% let index = 1; %>
                                    <% for (let teacher in GiangDay) { %>
                                        <% let courses = GiangDay[teacher]; %>
                                        <% let totalSoTiet = courses.reduce((total, course) => total + course.QuyChuan, 0); %> <!-- T√≠nh t·ªïng s·ªë ti·∫øt -->

                
                                        <% courses.forEach((course, courseIndex) => { %>
                                            <tr>
                                                <% if (courseIndex === 0) { %> 
                                                    <!-- G·ªôp d√≤ng v·ªõi rowspan b·∫±ng s·ªë l∆∞·ª£ng kh√≥a h·ªçc c·ªßa gi·∫£ng vi√™n -->
                                                    <td rowspan="<%= courses.length %>"><%= index %></td> <!-- S·ªë th·ª© t·ª± -->
                                                    <td rowspan="<%= courses.length %>"><%= teacher %></td> <!-- T√™n gi·∫£ng vi√™n -->
                                                    <% index++; %>
                                                <% } %>
                                                <td><%= course.LopHocPhan %></td> <!-- T√™n h·ªçc ph·∫ßn -->
                                                <td><%= course.Lop %></td> <!-- T√™n l·ªõp -->
                                                <td><%= course.SoTinChi %></td> <!-- S·ªë t√≠n ch·ªâ -->
                                                <td><%= course.QuyChuan %></td> <!-- S·ªë ti·∫øt -->
                                                <!-- T·ªïng s·ªë ti·∫øt -->
                                                <% if (courseIndex === 0) { %> 
                                                    <!-- G·ªôp d√≤ng v·ªõi rowspan b·∫±ng s·ªë l∆∞·ª£ng kh√≥a h·ªçc c·ªßa gi·∫£ng vi√™n -->
                                                    <td rowspan="<%= courses.length %>"><%= totalSoTiet %></td> <!-- T·ªïng s·ªë ti·∫øt -->
                                                    <td rowspan="<%= courses.length %>">
                                                        <button class="action-button view" onclick="viewClass('<%= parseInt(course.id_Gvm) - 1 %>')">üëÅÔ∏è</button> <!-- N√∫t xem chi ti·∫øt -->
                                                    </td>
                                                    
                                                <% } %>
                                            </tr>
                                           
                                        <% }); %>
                                    <% } %>
                                </tbody>
                            </table>
                            <!-- <div id="modal" class="modal" style="display: none">
                                <div class="modal-content">
                                    <span class="close-button" onclick="closeModal()">√ó</span>
                                    <h2 id="modal-title">Chi ti·∫øt gi·∫£ng vi√™n m·ªùi</h2>
                                    <br>
                                    <p><strong>M√£ gi·∫£ng vi√™n:</strong> <span id="modal-ma-gv"></span></p>
                                    <p><strong>H·ªç t√™n:</strong> <span id="modal-ho-ten"></span></p>
                                    <p><strong>Ng√†y sinh:</strong> <span id="modal-ngay-sinh"></span></p>
                                    <p><strong>CCCD:</strong> <span id="modal-cccd"></span></p>
                                    <p><strong>Ng√†y c·∫•p CCCD:</strong> <span id="modal-ngay-cap"></span></p>
                                    <p><strong>N∆°i c·∫•p CCCD:</strong> <span id="modal-noi-cap"></span></p>
                                    <p><strong>ƒê·ªãa ch·ªâ theo CCCD:</strong> <span id="modal-dia-chi-cccd"></span></p>
                                    <p><strong>S·ªë t√†i kho·∫£n:</strong> <span id="modal-so-tk"></span></p>
                                    <p><strong>Ng√¢n h√†ng:</strong> <span id="modal-ngan-hang"></span></p>
                                    <p><strong>Email:</strong> <span id="modal-email"></span></p>
                                    <p><strong>H·ªá s·ªë l∆∞∆°ng:</strong> <span id="modal-heso-luong"></span></p>
                                    <p><strong>N∆°i c√¥ng t√°c:</strong> <span id="modal-noi-cong-tac"></span></p>
                                    <p><strong>Ch·ª©c v·ª•:</strong> <span id="modal-chuc-vu"></span></p>
                                    <p><strong>M√£ s·ªë thu·∫ø:</strong> <span id="modal-ma-so-thue"></span></p>
                                </div>
                            </div> -->
                            <!-- <div class="pagination">
                              <span>10 / trang</span>
                              <button class="page-button">1</button>
                            </div> -->
                          </div>
                      
                          
                          <div id="modal" class="modal" style="display: none">
                            <div class="modal-content">
                                <span class="close-button" onclick="closeModal()">√ó</span>
                                <h2 id="modal-title">Chi ti·∫øt gi·∫£ng vi√™n m·ªùi</h2>
                                <br>
                                <p><strong>M√£ gi·∫£ng vi√™n:</strong> <span id="modal-ma-gv"></span></p>
                                <p><strong>H·ªç t√™n:</strong> <span id="modal-ho-ten"></span></p>
                                <p><strong>Ng√†y sinh:</strong> <span id="modal-ngay-sinh"></span></p>
                                <p><strong>CCCD:</strong> <span id="modal-cccd"></span></p>
                                <p><strong>Ng√†y c·∫•p CCCD:</strong> <span id="modal-ngay-cap"></span></p>
                                <p><strong>N∆°i c·∫•p CCCD:</strong> <span id="modal-noi-cap"></span></p>
                                <p><strong>ƒê·ªãa ch·ªâ theo CCCD:</strong> <span id="modal-dia-chi-cccd"></span></p>
                                <p><strong>S·ªë t√†i kho·∫£n:</strong> <span id="modal-so-tk"></span></p>
                                <p><strong>Ng√¢n h√†ng:</strong> <span id="modal-ngan-hang"></span></p>
                                <p><strong>Email:</strong> <span id="modal-email"></span></p>
                                <p><strong>H·ªá s·ªë l∆∞∆°ng:</strong> <span id="modal-heso-luong"></span></p>
                                <p><strong>N∆°i c√¥ng t√°c:</strong> <span id="modal-noi-cong-tac"></span></p>
                                <p><strong>Ch·ª©c v·ª•:</strong> <span id="modal-chuc-vu"></span></p>
                                <p><strong>M√£ s·ªë thu·∫ø:</strong> <span id="modal-ma-so-thue"></span></p>
                                <p><strong>T·ªët nghi·ªáp lo·∫°i:</strong> <span id="modal-tot-nghiep-loai"></span></p>

                            </div>
                        </div>
                        

                    </div>
                </div>
            </div>    
     </div>
    <script src="/bootstrap/dist/js/jquery-3.7.1.min.js"></script>
    <script src="/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // T√¨m ki·∫øm gi·∫£ng vi√™n m·ªùi theo t√™n
function searchClass() {
    let input = document.getElementById("searchInput").value.toLowerCase();
    let table = document.getElementById("classTable");
    let tr = table.getElementsByTagName("tr");
  
    for (let i = 1; i < tr.length; i++) {
      let td = tr[i].getElementsByTagName("td")[1];
      if (td) {
        let textValue = td.textContent || td.innerText;
        if (textValue.toLowerCase().indexOf(input) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }
  
 

  async function fetchGVMLists() {
    try {
        const response = await fetch('/api/classInfoGvm');
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const gvmLists = await response.json();
        return gvmLists;
    } catch (error) {
        console.error('Error fetching data:', error);
    }
  }
 

 async function viewClass( index) {

  gvmLists = await fetchGVMLists();

  index = parseInt(index);

  var gvm = gvmLists[index];
  
  
  // Hi·ªÉn th·ªã th√¥ng tin v√†o modal
document.getElementById('modal-ma-gv').innerText = gvm.MaGvm;
document.getElementById('modal-ho-ten').innerText = gvm.HoTen;
document.getElementById('modal-ngay-sinh').innerText = new Date(gvm.NgaySinh).toLocaleDateString('vi-VN');
document.getElementById('modal-cccd').innerText = gvm.CCCD;
document.getElementById('modal-ngay-cap').innerText = new Date(gvm.NgayCapCCCD).toLocaleDateString('vi-VN');
document.getElementById('modal-noi-cap').innerText = gvm.NoiCapCCCD;
document.getElementById('modal-dia-chi-cccd').innerText = gvm.DiaChi;
document.getElementById('modal-so-tk').innerText = gvm.STK;
document.getElementById('modal-ngan-hang').innerText = gvm.NganHang;
document.getElementById('modal-email').innerText = gvm.Email;
document.getElementById('modal-heso-luong').innerText = gvm.HSL;//
document.getElementById('modal-noi-cong-tac').innerText = gvm.NoiCongTac;
document.getElementById('modal-chuc-vu').innerText = gvm.ChucVu;
document.getElementById('modal-ma-so-thue').innerText = gvm.MaSoThue;
document.getElementById('modal-tot-nghiep-loai').innerText = gvm.TotNghiepLoai;

  // Hi·ªÉn th·ªã modal
  document.getElementById('modal').style.display = 'flex';
}
  

  
  // ƒê√≥ng modal
  function closeModal() {
    document.getElementById("modal").style.display = "none";
  }
  
  // Th√™m s·ª± ki·ªán khi nh·∫•n ra ngo√†i modal ƒë·ªÉ ƒë√≥ng modal
  window.onclick = function (event) {
    let modal = document.getElementById("modal");
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };
  
    </script>

    <script>
      // L·∫•y query string t·ª´ URL
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get('message');
      
      // L·∫•y ph·∫ßn t·ª≠ div ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
      const messageDiv = document.getElementById('message');

     // console.log(message)
      // Hi·ªÉn th·ªã th√¥ng b√°o d·ª±a tr√™n gi√° tr·ªã c·ªßa message
      if (message === 'insertSuccess') {
        alert("Update Success")
      } else if (message === 'insertFalse') {
        alert("Update False")
      }

        // Sau khi hi·ªÉn th·ªã th√¥ng b√°o, x√≥a query string ƒë·ªÉ tr√°nh hi·ªÉn th·ªã l·∫°i khi refresh
if (message) {
  // S·ª≠ d·ª•ng window.history ƒë·ªÉ x√≥a query string m√† kh√¥ng refresh l·∫°i trang
  const newUrl = window.location.origin + window.location.pathname;
  window.history.replaceState({}, document.title, newUrl);
}

    </script>


      <!-- Ph·∫ßn ph√¢n quy·ªÅn -->
  <script>
    async function fetchRole() {
        try {
            const response = await fetch('/api/getRole');
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const role = await response.json();
            return role;
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    async function ThongTinGD(){
        const role = await fetchRole();
        
        if (role.includes("CNTT")){
            window.location.href = "/info"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang mong mu·ªën
        } else if (role.includes("DAOTAO")){
            window.location.href = "/info2"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang mong mu·ªën
        }  // th√™m quy·ªÅn v√†o ƒë√¢y
    }

    async function Import(){
      const role = await fetchRole();

      if (role.includes("CNTT")){
          window.location.href = "/importGvmList"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang mong mu·ªën
      } else if (role.includes("DAOTAO")){
          window.location.href = "/import"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang mong mu·ªën
      }  // th√™m quy·ªÅn v√†o ƒë√¢y
  }

  async function Home(){
    const role = await fetchRole();

    if (role.includes("CNTT")){
        window.location.href = "/mainkhoa"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang mong mu·ªën
    } else if (role.includes("DAOTAO")){
        window.location.href = "/maindt"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang mong mu·ªën
    }  // th√™m quy·ªÅn v√†o ƒë√¢y
  }

   </script>
</body>
</html>

