<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
  <link rel="stylesheet" href="/css/table.css">
  <link rel="stylesheet" href="/css/teachingInfo.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    .container {
      position: relative;
      /* Ensure the dropdown positions relative to this container */
      display: inline-block;
      /* Allows for proper alignment */
    }

    .table>:not(caption)>*>* {
      border-bottom-width: 2px;
    }

    .table {
      border-color: #ffffff;
      z-index: 1;
    }

    .suggestions {
      position: absolute;
      /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m b√™n tr√™n c√°c th√†nh ph·∫ßn kh√°c */
      top: calc(100% + 5px);
      /* ƒê·∫∑t g·ª£i √Ω ph√≠a tr√™n input v·ªõi m·ªôt kho·∫£ng c√°ch */
      font-size: 12px;
      left: 0;
      background-color: #f0f0f0;
      color: #000;
      border: 1px solid #ccc;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m tr√™n c√°c th√†nh ph·∫ßn kh√°c */
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }

    /* Hi·ªáu ·ª©ng lung linh khi hover */
    .suggestions:hover {
      background-color: #e0e0e0;
      /* Thay ƒë·ªïi m√†u n·ªÅn khi hover */
      box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
      /* TƒÉng ƒë·ªô b√≥ng khi hover */
    }


    /* CSS cho t·ª´ng m·ª•c g·ª£i √Ω */
    .suggestion-item {
      padding: 8px 12px;
      /* Kho·∫£ng c√°ch b√™n trong t·ª´ng m·ª•c */
      cursor: pointer;
      /* Con tr·ªè chu·ªôt thay ƒë·ªïi khi hover */
      transition: background-color 0.2s ease;
      /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m∆∞·ª£t m√† khi hover */
    }

    /* Hi·ªáu ·ª©ng khi ng∆∞·ªùi d√πng di chu·ªôt v√†o m·ª•c g·ª£i √Ω */
    .suggestion-item:hover {
      background-color: #f0f0f0;
      /* M√†u n·ªÅn khi hover */
    }

    /* ƒê·∫∑t l·∫°i m·ªôt s·ªë thu·ªôc t√≠nh khi input m·∫•t focus */
    input:focus+.suggestions {
      display: block;
      /* ƒê·∫£m b·∫£o khung hi·ªÉn th·ªã khi input ƒë∆∞·ª£c focus */
    }

    /* ƒê·∫£m b·∫£o container g·ª£i √Ω kh√¥ng b·ªã tr√†n ra ngo√†i khung n·∫øu c√≥ */
    .suggestions {
      overflow: hidden;
    }

    /* ph·∫ßn css cho label t·ªïng s·ªë ti·∫øt ki*/
    .total-label {
      margin-left: auto;
      /* CƒÉn ph·∫£i cho th·∫ª total-label */
      margin-right: 0;
      font-family: Arial, sans-serif;
      font-size: 16px;
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
      width: fit-content;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: block;
      /* ƒê·∫£m b·∫£o th·∫ª div l√† kh·ªëi ƒë·ªÉ cƒÉn ph·∫£i ho·∫°t ƒë·ªông */
    }

    .total-label label {
      font-weight: bold;
      /* Gi·ªØ ch·ªØ in ƒë·∫≠m */
      color: #000;
      /* M√†u ch·ªØ ƒëen */
      margin-right: 8px;
      /* Th√™m kho·∫£ng c√°ch b√™n ph·∫£i */
      cursor: pointer;
      /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn m√†u n·ªÅn v√† m√†u ch·ªØ m·ªÅm m·∫°i */
      padding: 5px 10px;
      /* Th√™m padding cho label ƒë·ªÉ t·∫°o kh√¥ng gian */
      border: 1px solid #ccc;
      /* Khung cho label */
      border-radius: 4px;
      /* Bo g√≥c cho khung */
    }

    .total-label label,
    .total-label label span {
      background-color: #007BFF;
      /* M√†u n·ªÅn khi hover */
      color: #fff;
      /* M√†u ch·ªØ tr·∫Øng khi hover */
    }

    .total-label span {
      font-weight: bold;
      /* Gi·ªØ ch·ªØ trong span c≈©ng in ƒë·∫≠m */
      color: #333;
      /* M√†u ch·ªØ ƒë·∫≠m cho gi√° tr·ªã */
    }

    /* ƒê·∫∑t chi·ªÅu r·ªông c·ªë ƒë·ªãnh cho c·∫£ input[type="date"] v√† input[type="text"] */
    input[type="date"],
    input[type="text"] {
      width: 120px;
      /* ƒêi·ªÅu ch·ªânh gi√° tr·ªã n√†y theo mong mu·ªën */
      box-sizing: border-box;
      padding: 5px;
      /* Gi·ªØ padding nh∆∞ c≈© */
    }

    .btn {
      margin-bottom: 0px;
      height: 45px;
    }
  </style>
</head>

<body>

  <nav class="navbar-top ">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="/Logo-Hoc-Vien-Ky-Thuat-Mat-Ma-ACTVN.webp" alt="Logo">
        <div class="navbar-title">
          <img src="/dongchu_banner.png" alt="banner">
        </div>
      </a>
    </div>
  </nav>

  <!-- Ph·∫ßn d∆∞·ªõi c·ªßa navbar ch·ª©a c√°c m·ª•c n·∫±m ngang -->

  <nav class="navbar navbar-expand-lg navbar-bottom sticky-top">
    <div class="" style="width: 100%">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" style="width: 100%" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" id="Home" href=""><i class="fa-solid fa-house"></i></a>
          </li>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                Gi·∫£ng Vi√™n M·ªùi
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" href="/gvmList">Danh s√°ch gi·∫£ng vi√™n m·ªùi</a>
                <a class="nav-link" id="actionButton1" href="/importGvmList" style="width: 100%;">Th√™m gi·∫£ng vi√™n m·ªùi
                  b·∫±ng file</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle active" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                B·∫£ng Quy Chu·∫©n
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" href="/import" id="actionButton2" style="width: 100%;">Th√™m file quy chu·∫©n</a>
                <a class="nav-link" href="/tableTam">B·∫£ng quy chu·∫©n d·ª± ki·∫øn</a>
                <a class="nav-link" href="/tableQC">B·∫£ng quy chu·∫©n ch√≠nh th·ª©c</a>
                <a class="nav-link active" id="ThongTinGD" href="">Th√¥ng tin gi·∫£ng vi√™n theo l·ªõp</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle " href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                M·ªùi Gi·∫£ng
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" href="/xemCacLopGvm">Xem c√°c l·ªõp m·ªùi</a>
                <a class="nav-link " href="/classInfoGvm">Th√¥ng tin l·ªõp gi·∫£ng vi√™n m·ªùi</a>
                <a class="nav-link" href="/hopDongDuKien" role="button">H·ª£p ƒë·ªìng d·ª± ki·∫øn</a>
                <a class="nav-link" href="/infoHDGvm" role="button">Th√¥ng tin h·ª£p ƒë·ªìng</a>
                <li class="nav-item"></li>
                <a class="nav-link " href="/phuLucHD">Ph·ª• l·ª•c h·ª£p ƒë·ªìng</a>
                </li>
                <a class="nav-link " href="/exportHD">H·ª£p ƒê·ªìng</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                V∆∞·ª£t Gi·ªù
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="#">COMING SOON</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                Nghi√™n C·ª©u Khoa H·ªçc
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="#">COMING SOON</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                ƒê·ªì √Ån
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="#">COMING SOON</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                Th·ªëng K√™
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="#">COMING SOON</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                H·ªá Th·ªëng
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="log">Xem File Log</a>
              </div>
            </div>
          </div>
        </ul>
        <div class="navbar-nav">
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle fullname" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
              aria-expanded="false">
              Hi, L√™ ƒê·ª©c Thu·∫≠n
            </a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Th√¥ng tin c√° nh√¢n</a>
              <a class="dropdown-item" id="changePasswordLink">ƒê·ªïi m·∫≠t kh·∫©u</a>
              <a class="dropdown-item" href="/">ƒêƒÉng xu·∫•t</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  </div>
  </nav>
  <div class="container-fluid box m-4">
    <div class="">
      <div class="d-flex justify-content-between">
        <div class="cbb d-flex" style="margin-top: 20px;">
          <select class="selectop w-100px mx-1 " id="combobox-dot">
            <option value="">ƒê·ª£t</option>
          </select>

          <!-- Combo box ƒê·ª£t -->
          <select class="selectop w-100px mx-1 " id="combobox-ki">
            <option value="">K·ª≥</option>
          </select>

          <!-- Combo box NƒÉm -->
          <select class="selectop w-100px mx-1 " id="NamHoc">
            <option value="">NƒÉm h·ªçc</option>
          </select>
          <button id="getData" class="btn text-nowrap mx-3" style="width: max-content;">Hi·ªÉn th·ªã</button>
          <!-- <button id="infoGvm" class="button text-nowrap">Xem b·∫£ng c·ª•c b·ªô</button> -->
          <!-- <button id="update-qc" onclick="updateLocalTable()" class="btn mx-3 luuTamThoi">L∆∞u</button> -->
          <button id="update-qc" onclick="submitData()" class="btn mx-3 luu">C·∫≠p nh·∫≠t</button>
        </div>

      </div>


      <div class="d-flex my-3" style="height: 70px;">
        <!-- T√¨m ki·∫øm theo gi·∫£ng vi√™n -->
        <input type="text" id="filterName" placeholder="T√¨m theo gi·∫£ng vi√™n TKB" oninput="filterByName()"
          class="form-control my-2 mx-1 search" style="width: 180px;" />
        <!-- T√¨m ki·∫øm theo t√™n h·ªçc ph·∫ßn -->
        <input type="text" id="filterClass" placeholder="T√¨m theo t√™n h·ªçc ph·∫ßn" oninput="filterByClass()"
          class="form-control my-2 mx-1 search" style="width: 180px;" />
        <!-- T√¨m ki·∫øm theo b·ªô m√¥n -->
        <input type="text" id="filterBoMon" placeholder="T√¨m theo t√™n b·ªô m√¥n"
          oninput="filterBoMon(); showSuggestionsBoMon(this)" onclick="showSuggestionsBoMon(this)"
          class="form-control my-2 mx-1 search" style="width: 180px;" />

        <div class="input-group my-2 mx-1" style="width: 350px;" id="batdau">
          <label for="startDate" class="input-group-text">Ng√†y b·∫Øt ƒë·∫ßu</label>
          <input required type="date" id="startDate" class="form-control" />
        </div>
        <div class="input-group my-2 mx-1" style="width: 350px;" id="ketthuc">

          <label for="endDate" class="input-group-text">Ng√†y k·∫øt th√∫c</label>
          <input required type="date" id="endDate" class="form-control" />
        </div>
        <button id="fillDay" class="btn text-nowrap my-2 mx-1" style="height: 54px;">Ch√®n ng√†y</button>


        <!-- <button class="button-action SapXep " id="sortTeachersByName">S·∫Øp X·∫øp</button> -->


        <script>
          document.getElementById('sortTeachersByName').addEventListener('click', sortTeachersByName);

          function sortTeachersByName() {
            const tableBody = document.getElementById('tableBody');
            const rows = Array.from(tableBody.rows);

            // Lo·∫°i b·ªè h√†ng ti√™u ƒë·ªÅ kh·ªèi qu√° tr√¨nh s·∫Øp x·∫øp
            const dataRows = rows.slice(); // L·∫•y t·∫•t c·∫£ c√°c h√†ng d·ªØ li·ªáu

            // S·∫Øp x·∫øp c√°c h√†ng d·ªØ li·ªáu d·ª±a tr√™n t√™n gi√°o vi√™n
            dataRows.sort((a, b) => {
              const teacherA = a.cells[2].textContent.trim();
              const teacherB = b.cells[2].textContent.trim();

              // S·∫Øp x·∫øp theo ti√™u chu·∫©n ti·∫øng Vi·ªát
              return teacherA.localeCompare(teacherB, 'vi', { sensitivity: 'base' });
            });

            // X√≥a b·∫£ng v√† ch√®n l·∫°i c√°c h√†ng d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
            tableBody.innerHTML = ''; // X√≥a c√°c h√†ng hi·ªán c√≥
            dataRows.forEach(row => tableBody.appendChild(row)); // Ch√®n l·∫°i c√°c h√†ng d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
          }

        </script>

        <script>
          function sortTableByColumn(columnIndex, direction) {
            const tableBody = document.getElementById('tableBody');
            const rows = Array.from(tableBody.rows);

            rows.sort((a, b) => {
              const cellA = a.cells[columnIndex].textContent.trim();
              const cellB = b.cells[columnIndex].textContent.trim();

              if (direction === 'asc') {
                return cellA.localeCompare(cellB, 'vi', { sensitivity: 'base' });
              } else {
                return cellB.localeCompare(cellA, 'vi', { sensitivity: 'base' });
              }
            });

            tableBody.innerHTML = ''; // Clear current rows
            rows.forEach(row => tableBody.appendChild(row)); // Append sorted rows
          }
        </script>

      </div>




      <div id="renderInfo">
        <table class="text-center">
          <thead>
            <tr>
              <th style="width: 200px;">H·ªçc ph·∫ßn</th>
              <th style="width: 50px;">S·ªë TC</th>
              <th style="width: 200px;">
                <span onclick="sortTableByColumn(2, 'asc')">GV theo TKB</span>
                <span class="sort-icon">
                  <i class="bi bi-arrow-up" onclick="sortTableByColumn(2, 'asc')"></i>
                  <i class="bi bi-arrow-down" onclick="sortTableByColumn(2, 'desc')"></i>
                </span>
              </th>
              <th style="width: 50px;">M·ªùi gi·∫£ng?</th>
              <th style="width: 100px;">GV gi·∫£ng d·∫°y</th>
              <th style="width: 50px;">Khoa</th>
              <th style="width: 100px;">B·ªô m√¥n</th>
              <th style="width: 50px;">S·ªë ti·∫øt LL</th>
              <th style="width: 50px;">S·ªë ti·∫øt QC</th>
              <th style="width: 50px;">Ng√†y b·∫Øt ƒë·∫ßu</th>
              <th style="width: 50px;">Ng√†y k·∫øt th√∫c</th>
              <th style="width: 50px">Ghi ch√∫</th>
              <th style="width: 50px; display: none" id="khoaColumn">
                <div class="form-check">
                  Khoa
                  <input class="form-check-input" type="checkbox" id="checkAllKhoa" onclick="checkAll('khoa')">
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td id="ankhoa"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Label t·ªïng s·ªë ti·∫øt t√°ch ri√™ng v·ªõi b·∫£ng -->
    <div class="total-label">
      <label>T·ªïng s·ªë ti·∫øt L√™n L·ªõp: <span class="value" id="totalLL">0</span></label>
      <label>T·ªïng s·ªë ti·∫øt Quy Chu·∫©n: <span class="value" id="totalQC">0</span></label>
    </div>
  </div>
  </div>
  <div id="modalBackdrop" style="display: none;"></div> <!-- N·ªÅn t·ªëi -->
  <div id="noteForm" style="display: none;">
    <h3>Ghi ch√∫</h3>
    <label for="noteInput">N·ªôi dung:</label>
    <textarea id="noteInput"></textarea> <!-- S·ª≠ d·ª•ng textarea cho ghi ch√∫ d√†i -->
    <br />
    <label for="deadlineInput">H·∫°n:</label>
    <input type="date" id="deadlineInput"
      style="width: 100%; padding: 5px; border: 1px solid #ccc; border-radius: 4px;" />
    <br />
    <div class="d-flex text-nowrap" style="text-align: right;">
      <button onclick="saveNote()">L∆∞u</button>
      <button onclick="doneNote()">Ho√†n Th√†nh</button>
      <button class="cancel" onclick="closeNoteForm()">ƒê√≥ng</button>
    </div>
  </div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    $(document).ready(function () {
      const isKhoa = localStorage.getItem("isKhoa");
      console.log('Gi√° tr·ªã isKhoa t·ª´ localStorage: ', isKhoa);
      hideButton();
      const Ban = localStorage.getItem("MaPhongBan");
      console.log('Gi√° tr·ªã Ban t·ª´ localStorage: ', Ban);
    });

    function hideButton() {
      const isKhoa = localStorage.getItem("isKhoa");
      if (isKhoa === null) {
        console.log('Kh√¥ng t√¨m th·∫•y gi√° tr·ªã isKhoa trong localStorage');
      } else {
        console.log('Gi√° tr·ªã isKhoa: ', isKhoa);

        const actionButton = document.getElementById('actionButton');
        const actionButton1 = document.getElementById('actionButton1');
        const actionButton2 = document.getElementById('actionButton2');

        if (actionButton1 && actionButton2) {
          if (isKhoa === "0") {
            actionButton1.style.display = 'none'; // ·∫®n actionButton1 n·∫øu isKhoa = 0
            actionButton2.style.display = 'inline-block'; // Hi·ªán actionButton2
            console.log('N√∫t actionButton1 ƒë√£ ƒë∆∞·ª£c ·∫©n, actionButton2 ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã');
          } else {
            actionButton1.style.display = 'inline-block'; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
            actionButton2.style.display = 'none'; // ·∫®n actionButton2
            console.log('N√∫t actionButton1 ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã, actionButton2 ƒë√£ ƒë∆∞·ª£c ·∫©n');
          }
        } else {
          console.log('Kh√¥ng t√¨m th·∫•y c√°c n√∫t actionButton1 ho·∫∑c actionButton2');
        }
      }
    }
  </script>

  <!-- ph·∫ßn hi·ªÉn th·ªã ph√¢n theo role -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const role = localStorage.getItem("userRole");

      // Ch·ªâ cho nh·∫≠p ng√†y b·∫Øt ƒë·∫ßu ng√†y k·∫øt th√∫c v·ªõi role thi h√†nh
      // if (role && role.includes('GV_CNBM')) {
      // document.getElementById('batdau').style.display = '';
      // document.getElementById('ketthuc').style.display = '';
      // }

      // N·∫øu role l√† 1 trong 3 gi√° tr·ªã sau th√¨ hi·ªÉn th·ªã c·ªôt, ng∆∞·ª£c l·∫°i th√¨ ·∫©n
      if (role === 'L√£nh ƒë·∫°o khoa') {
        // Hi·ªÉn th·ªã c·ªôt 'khoaColumn'
        document.getElementById('khoaColumn').style.display = 'table-cell';
      } else {
        // ·∫®n c·ªôt 'khoaColumn'
        document.getElementById('khoaColumn').style.display = 'none';
        document.getElementById('ankhoa').style.display = 'none';
      }
    });

  </script>

  <!-- ph·∫ßn ch√®n ng√†y, render b·∫£ng v√† v√† c√°c h√†m li√™n quan -->
  <script>

    document.addEventListener('DOMContentLoaded', function () {
      var totalLL;
      var totalQC;
      var globalDataNew = [];

      // s·ª± ki·ªán click ch√®n ng√†y
      document.getElementById('fillDay').addEventListener('click', function () {
        // L·∫•y gi√° tr·ªã ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c t·ª´ ng∆∞·ªùi d√πng
        const globalStartDate = document.getElementById('startDate').value;
        const globalEndDate = document.getElementById('endDate').value;

        // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ch∆∞a nh·∫≠p ng√†y
        if (!globalStartDate || !globalEndDate) {
          alert('Vui l√≤ng nh·∫≠p ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c.');
          return;
        }

        // L·∫•y d·ªØ li·ªáu g·ªëc t·ª´ localStorage
        let data = JSON.parse(localStorage.getItem('tableData')) || [];
        console.log('D·ªØ li·ªáu ban ƒë·∫ßu t·ª´ localStorage:', data);

        // L·∫•y t·∫•t c·∫£ c√°c d√≤ng hi·ªÉn th·ªã trong b·∫£ng
        const rows = document.querySelectorAll('#tableBody tr');

        rows.forEach(row => {
          // B·ªè qua h√†ng b·ªã ·∫©n
          if (row.style.display === 'none') {
            return;
          }

          // L·∫•y id c·ªßa h√†ng t·ª´ thu·ªôc t√≠nh data-id
          const rowId = row.getAttribute('data-id');
          // console.log('id trong b·∫£ng ƒëang hi·ªÉn th·ªã : ', rowId);

          // T√¨m ƒë·ªëi t∆∞·ª£ng trong localStorage c√≥ id tr√πng v·ªõi h√†ng hi·ªán t·∫°i
          let item = data.find(d => parseInt(d.id) === parseInt(rowId));
          // console.log('id trong b·∫£ng d·ªØ li·ªáu ch√≠nh : ', item.id);

          // N·∫øu t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng v√† KhoaDuyet == 0
          if (item && item.KhoaDuyet == 0) {
            // ƒê·ªãnh d·∫°ng ng√†y tr∆∞·ªõc khi l∆∞u ƒë·ªÉ tr√°nh l·ªói m√∫i gi·ªù
            item.NgayBatDau = format(globalStartDate);
            item.NgayKetThuc = format(globalEndDate);

            // C·∫≠p nh·∫≠t ng√†y trong h√†ng c·ªßa b·∫£ng ƒë·ªÉ hi·ªÉn th·ªã thay ƒë·ªïi
            const ngayBatDauCell = row.querySelector('.ngay-bat-dau');
            const ngayKetThucCell = row.querySelector('.ngay-ket-thuc');
            if (ngayBatDauCell) ngayBatDauCell.textContent = item.NgayBatDau; // Hi·ªÉn th·ªã ng√†y ƒë√£ ƒë·ªãnh d·∫°ng
            if (ngayKetThucCell) ngayKetThucCell.textContent = item.NgayKetThuc; // Hi·ªÉn th·ªã ng√†y ƒë√£ ƒë·ªãnh d·∫°ng
          }
        });

        // Ki·ªÉm tra ƒë·ªãnh d·∫°ng ng√†y v√† format l·∫°i n·∫øu c·∫ßn
        data.forEach(item => {
          if (item.NgayBatDau && isISODate(item.NgayBatDau)) {
            item.NgayBatDau = format(item.NgayBatDau);
          }
          if (item.NgayKetThuc && isISODate(item.NgayKetThuc)) {
            item.NgayKetThuc = format(item.NgayKetThuc);
          }
        });

        // L∆∞u l·∫°i to√†n b·ªô d·ªØ li·ªáu ƒë√£ c·∫≠p nh·∫≠t v√†o localStorage
        // localStorage.setItem('tableData', JSON.stringify(data));

        // Ki·ªÉm tra l·∫°i d·ªØ li·ªáu sau khi c·∫≠p nh·∫≠t
        console.log('D·ªØ li·ªáu sau khi ch√®n:', data);

        // G·ª≠i d·ªØ li·ªáu ƒë√£ c·∫≠p nh·∫≠t l√™n server
        fetch('http://localhost:3000/check-teaching', {
          method: 'POST', // Ph∆∞∆°ng th·ª©c POST
          headers: {
            'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
          },
          body: JSON.stringify(data) // Chuy·ªÉn ƒë·ªïi data ƒë√£ c·∫≠p nh·∫≠t th√†nh chu·ªói JSON
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
            }
            return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
          })
          .then(data => {
            // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
            alert(data.message);
            console.log(data.message);
            loadData();
            viewData();
          })
          .catch(error => {
            console.error('C√≥ l·ªói x·∫£y ra:', error);
            alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.');
          });
      });
      // load data l·∫•y d·ªØ li·ªáu t·ª´ server
      document.getElementById('getData').addEventListener('click', loadData);

      // view data l·∫•y d·ªØ li·ªáu t·ª´ storage
      function viewData() {
        let data = JSON.parse(localStorage.getItem('tableData'));
        renderTable(data);
        calculateTotals();
      }

      // l·∫•y d·ªØ li·ªáu t∆∞∆°ng ·ª©ng t·ª´ t·ª´ b·∫£ng quy chu·∫©n, l·∫•y d·ªØ li·ªáu b·∫£ng b·ªô m√¥n, l∆∞u v√†o b·∫£ng trong local storage
      async function loadData() {

        const MaPhongBan = localStorage.getItem("MaPhongBan");

        try {
          const response = await fetch('http://localhost:3000/bo-mon-theo-gv', {
            method: 'GET', // Thay ƒë·ªïi th√†nh POST
            // headers: {
            //   'Content-Type': 'application/json'
            // },
            // body: JSON.stringify({ MaPhongBan }) // G·ª≠i MaPhongBan trong th√¢n y√™u c·∫ßu
          });

          if (!response.ok) {
            throw new Error(`Error: ${response.status} - ${response.statusText}`);
          }

          const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          localStorage.setItem('boMonTheoGiangVien', JSON.stringify(data));
          const boMonTheoGiangVien = JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
          console.log(boMonTheoGiangVien);
          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n

        } catch (error) {
          console.error('C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:', error);
        }

        try {
          const response = await fetch('http://localhost:3000/bo-mon', {
            method: 'POST', // Thay ƒë·ªïi th√†nh POST
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ MaPhongBan }) // G·ª≠i MaPhongBan trong th√¢n y√™u c·∫ßu
          });

          if (!response.ok) {
            throw new Error(`Error: ${response.status} - ${response.statusText}`);
          }

          const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          localStorage.setItem('boMon', JSON.stringify(data));
          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n

        } catch (error) {
          console.error('C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:', error);
        }



        try {
          // L·∫•y gi√° tr·ªã t·ª´ c√°c combobox
          const dotValue = document.getElementById('combobox-dot').value;
          const kiValue = document.getElementById('combobox-ki').value;
          const namValue = document.getElementById('NamHoc').value;

          // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë·ªÉ g·ª≠i
          const requestData = {
            Dot: dotValue,
            Ki: kiValue,
            Nam: namValue,
          };

          // G·ªçi API ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi
          console.log('G·ªçi API l·∫•y d·ªØ li·ªáu m·ªõi...');

          const [gvmResponse, khoaResponse, teachingResponse] = await Promise.all([
            fetch('http://localhost:3000/index/name-gvm'),
            fetch('http://localhost:3000/index/name-gvm-khoa'),
            fetch('http://localhost:3000/teaching-info', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestData),
            }),
          ]);

          // Ki·ªÉm tra xem c√≥ l·ªói trong c√°c ph·∫£n h·ªìi kh√¥ng
          if (!gvmResponse.ok || !khoaResponse.ok || !teachingResponse.ok) {
            alert("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu!");
            return; // D·ª´ng l·∫°i n·∫øu c√≥ l·ªói
          }

          // L∆∞u d·ªØ li·ªáu m·ªõi v√†o bi·∫øn
          const nameGvNew = await gvmResponse.json();
          const nameGvmNew = await khoaResponse.json();
          const rs = await teachingResponse.json();

          // Th√™m check
          globalDataNew = rs.results; // D·ªØ li·ªáu k·∫øt qu·∫£
          // globalData = globalDataNew;
          const check = rs.check; // D·ªØ li·ªáu check

          localStorage.setItem("check", check);

          // Ki·ªÉm tra d·ªØ li·ªáu trong localStorage
          let cachedData = localStorage.getItem('tableData');

          // // N·∫øu c√≥ d·ªØ li·ªáu trong localStorage
          // if (cachedData) {
          //   cachedData = JSON.parse(cachedData);
          //   // So s√°nh d·ªØ li·ªáu m·ªõi v·ªõi d·ªØ li·ªáu c≈©
          //   const isDataEqual = (JSON.stringify(cachedData) === JSON.stringify(globalDataNew));

          //   if (isDataEqual) {
          //     console.log('D·ªØ li·ªáu kh√¥ng thay ƒë·ªïi, s·ª≠ d·ª•ng d·ªØ li·ªáu t·ª´ localStorage');
          //     console.log(cachedData)
          //     // Render b·∫£ng t·ª´ d·ªØ li·ªáu ƒë√£ cache
          //     renderTable(cachedData);
          //     calculateTotals();
          //     window.location.reload();
          //     return;
          //   }
          // }

          // N·∫øu c√≥ s·ª± thay ƒë·ªïi, c·∫≠p nh·∫≠t localStorage
          localStorage.setItem('nameGv', JSON.stringify(nameGvNew));
          localStorage.setItem('nameGvm', JSON.stringify(nameGvmNew));

          // th√™m id v√†o b·∫£ng local
          globalDataNew = globalDataNew.map((item, index) => ({
            ...item,
            id: index // ho·∫∑c m·ªôt ID kh√°c t√πy theo logic b·∫°n mu·ªën
          }));
          // ƒë·∫©y v√†o b·∫£ng local
          localStorage.setItem('tableData', JSON.stringify(globalDataNew));

          console.log('B·∫£ng : ', globalDataNew);

          viewData(globalDataNew);

        } catch (error) {
          console.error('ƒê√£ c√≥ l·ªói x·∫£y ra:', error);
        }
      }

      // render ra b·∫£ng
      function renderTable(data) {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = ''; // X√≥a n·ªôi dung c≈©

        const role = localStorage.getItem("userRole");
        const isKhoa = parseInt(localStorage.getItem("isKhoa"), 10); // Chuy·ªÉn ƒë·ªïi isKhoa th√†nh s·ªë
        const MaPhongBan = localStorage.getItem("MaPhongBan")

        // id truy·ªÅn v√†o ƒë·ªÉ ƒë√°nh d·∫•u m·ªói d√≤ng, m·ª•c ƒë√≠ch l·∫•y ph·∫ßn t·ª≠ v√† so s√°nh v·ªõi b·∫£ng trong localStorage
        data.forEach((row, id) => {
          const tableRow = document.createElement('tr');


          // G√°n id v√†o thu·ªôc t√≠nh data-id c·ªßa h√†ng
          tableRow.setAttribute("data-id", id);

          const lopHocPhanTd = document.createElement('td');
          lopHocPhanTd.textContent = `${row.LopHocPhan} (${row.TenLop})` || '';
          tableRow.appendChild(lopHocPhanTd);

          const soTcTd = document.createElement('td');
          soTcTd.textContent = row.SoTinChi || '';
          tableRow.appendChild(soTcTd);

          const giaoVienTd = document.createElement('td');
          giaoVienTd.textContent = row.GiaoVien || '';
          tableRow.appendChild(giaoVienTd);

          // T·∫°o m·ªôt √¥ td cho checkbox
          const moiGiangTd = document.createElement('td');

          // T·∫°o checkbox
          const inviteCheckbox = document.createElement('input');
          inviteCheckbox.name = 'moigiang';
          inviteCheckbox.type = 'checkbox';
          inviteCheckbox.checked = row.MoiGiang || false;

          // Th√™m checkbox v√†o √¥ td
          moiGiangTd.appendChild(inviteCheckbox);

          // Th√™m √¥ td v√†o h√†ng b·∫£ng
          tableRow.appendChild(moiGiangTd);


          const giaoVienGiangDayTd = document.createElement('td');
          const giaoVienGiangDayInput = document.createElement('input');
          giaoVienGiangDayInput.type = 'text';
          giaoVienGiangDayInput.placeholder = 'Nh·∫≠p t√™n gi·∫£ng vi√™n';
          giaoVienGiangDayInput.value = row.GiaoVienGiangDay || '';


          giaoVienGiangDayTd.appendChild(giaoVienGiangDayInput);
          tableRow.appendChild(giaoVienGiangDayTd);
          giaoVienGiangDayInput.onclick = () => {
            const moiGiang = inviteCheckbox.checked;
            showSuggestions(giaoVienGiangDayInput, moiGiang, row.id);
          };

          giaoVienGiangDayInput.oninput = () => {
            const moiGiang = inviteCheckbox.checked;
            showSuggestions(giaoVienGiangDayInput, moiGiang, row.id);
          };

          giaoVienGiangDayTd.appendChild(giaoVienGiangDayInput);
          tableRow.appendChild(giaoVienGiangDayTd);

          giaoVienGiangDayTd.appendChild(giaoVienGiangDayInput);
          tableRow.appendChild(giaoVienGiangDayTd);

          const khoaTd = document.createElement('td');
          khoaTd.textContent = row.Khoa || '';
          tableRow.appendChild(khoaTd);

          const boMonTd = document.createElement('td');
          const boMonInput = document.createElement('input');
          boMonInput.type = 'text';
          boMonInput.name = 'bomon';
          boMonInput.value = row.BoMon || '';
          boMonInput.placeholder = 'Nh·∫≠p t√™n b·ªô m√¥n';
          boMonTd.appendChild(boMonInput);
          tableRow.appendChild(boMonTd);

          boMonInput.onclick = () => {
            showSuggestionsBoMon(boMonInput);
          };
          boMonInput.oninput = () => {
            showSuggestionsBoMon(boMonInput);
          };


          const soTietLLTd = document.createElement('td');
          soTietLLTd.textContent = row.LL || '';
          tableRow.appendChild(soTietLLTd);

          const soTietQCTd = document.createElement('td');
          soTietQCTd.textContent = row.QuyChuan || '';
          tableRow.appendChild(soTietQCTd);

          // C·ªôt Ng√†y B·∫Øt ƒê·∫ßu
          const ngayBatDauTd = document.createElement('td');
          const ngayBatDauInput = document.createElement('input');
          ngayBatDauInput.type = 'date';
          ngayBatDauInput.name = 'startDate';
          ngayBatDauInput.value = formatDate(row.NgayBatDau); // ƒê·ªãnh d·∫°ng ng√†y

          // Th√™m s·ª± ki·ªán paste cho input ng√†y b·∫Øt ƒë·∫ßu
          ngayBatDauInput.addEventListener('paste', (event) => {
            handleDatePaste(event, ngayBatDauInput);
          });

          ngayBatDauTd.appendChild(ngayBatDauInput);
          tableRow.appendChild(ngayBatDauTd);

          // C·ªôt Ng√†y K·∫øt Th√∫c
          const ngayKetThucTd = document.createElement('td');
          const ngayKetThucInput = document.createElement('input');
          ngayKetThucInput.type = 'date';
          ngayKetThucInput.name = 'endDate';
          ngayKetThucInput.value = formatDate(row.NgayKetThuc); // ƒê·ªãnh d·∫°ng ng√†y

          // Th√™m s·ª± ki·ªán paste cho input ng√†y k·∫øt th√∫c
          ngayKetThucInput.addEventListener('paste', (event) => {
            handleDatePaste(event, ngayKetThucInput);
          });

          ngayKetThucTd.appendChild(ngayKetThucInput);
          tableRow.appendChild(ngayKetThucTd);

          const ghiChuTd = document.createElement("td");
          const ghiChuValue = row.GhiChu && row.GhiChu.trim() !== "" ? row.GhiChu : false;
          const deadlineValue = row.Deadline || ""; // L·∫•y gi√° tr·ªã Deadline
          if (ghiChuValue) {
            ghiChuTd.innerHTML = `üìú <span style="color: red;">‚Ä¢</span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m ƒë·ªè
          } else {
            ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu kh√¥ng c√≥ ghi ch√∫
          }
          ghiChuTd.style.cursor = "pointer"; // Thay ƒë·ªïi con tr·ªè chu·ªôt khi di chu·ªôt qua bi·ªÉu t∆∞·ª£ng
          ghiChuTd.onclick = () => openNoteForm(tableRow, ghiChuValue, deadlineValue); // G·ªçi h√†m m·ªü form khi nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng
          tableRow.appendChild(ghiChuTd); // Th√™m √¥ ghi ch√∫ v√†o h√†ng



          let khoaCheckboxTd, khoaCheckbox;
          khoaCheckboxTd = document.createElement('td');
          khoaCheckbox = document.createElement('input');
          khoaCheckbox.type = 'checkbox';
          khoaCheckbox.name = 'khoa';
          khoaCheckbox.checked = row.KhoaDuyet || false;
          khoaCheckbox.onchange = () => updateCheckAll('khoa');
          khoaCheckboxTd.appendChild(khoaCheckbox);
          tableRow.appendChild(khoaCheckboxTd);
          // ƒêi·ªÅu ki·ªán ·∫©n checkbox Khoa n·∫øu role kh√¥ng ph·∫£i "CNTT_ALL"
          if (role != "L√£nh ƒë·∫°o khoa") {
            // Thi·∫øt l·∫≠p thu·ªôc t√≠nh CSS ƒë·ªÉ thu nh·ªè checkbox v√† √¥ <td> ch·ª©a n√≥
            khoaCheckbox.style.width = '10px'; // ƒê·∫∑t chi·ªÅu r·ªông nh·ªè nh·∫•t c√≥ th·ªÉ
            khoaCheckbox.style.height = '10px'; // ƒê·∫∑t chi·ªÅu cao nh·ªè nh·∫•t c√≥ th·ªÉ
            khoaCheckbox.style.display = 'none';

            // Thu nh·ªè <td>
            khoaCheckboxTd.style.width = '1px';
            khoaCheckboxTd.style.padding = '0';
          }


          // N·∫øu L√£nh ƒë·∫°o khoa ƒë√£ duy·ªát, thi h√†nh s·∫Ω kh√¥ng nh·∫≠p ƒë∆∞·ª£c
          // N·∫øu role l√† gi·∫£ng vi√™n th∆∞·ªùng c≈©ng s·∫Ω kh√¥ng nh·∫≠p ƒë∆∞·ª£c
          if (role == "GV" || row.KhoaDuyet == 1) {
            inviteCheckbox.disabled = true
            giaoVienGiangDayInput.disabled = true;
            boMonInput.disabled = true;
            ngayBatDauInput.disabled = true;
            // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i ng√†y k·∫øt th√∫c
            ngayKetThucInput.disabled = true;
          }

          const check = localStorage.getItem("check");

          // Ph√¢n quy·ªÅn theo ph√≤ng ban
          if (isKhoa == 1) { // N·∫øu l√† khoa
            if (check.includes(MaPhongBan)) {
              inviteCheckbox.disabled = true;

              giaoVienGiangDayInput.disabled = true;
              boMonInput.disabled = true;
              ngayBatDauInput.disabled = true;
              // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i ng√†y k·∫øt th√∫c
              ngayKetThucInput.disabled = true;

              if (role == "L√£nh ƒë·∫°o khoa") {
                khoaCheckbox.disabled = true;

                // NgƒÉn checkbox t·ªïng c·ªßa 'khoa' kh√¥ng cho thay ƒë·ªïi
                disableCheckAll('khoa');

              }
              // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i checkbox

            }
          }

          // Th√™m h√†ng v√†o body c·ªßa b·∫£ng
          tableBody.appendChild(tableRow);
        });

        // Th√™m s·ª± ki·ªán khi doubleclick ƒë·ªÉ c√≥ th·ªÉ copy ƒë∆∞·ª£c ng√†y
        addDoubleClickEvents();
      }

      function addDoubleClickEvents() {
        // get all date input fields
        let dateInputs = document.querySelectorAll('[type="date"]');

        dateInputs.forEach(el => {
          // register double-click event to change date input to text input and select the value
          el.addEventListener('dblclick', () => {
            el.type = "text";

            // After changing input type with JS, .select() needs a timeout to work
            setTimeout(() => {
              el.select();
            });
          });

          // register the focusout event to reset the input back to a date input field
          el.addEventListener('focusout', () => {
            el.type = "date";
          });
        });
      }


      function disableCheckAll(type) {
        const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);

        if (checkAllCheckbox) {
          // NgƒÉn kh√¥ng cho ng∆∞·ªùi d√πng thay ƒë·ªïi checkbox t·ªïng
          checkAllCheckbox.addEventListener('click', function (e) {
            e.preventDefault(); // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i
          });
        }
      }

      // x·ª≠ l√≠ hi·ªÉn th·ªã ng√†y th√°ng nƒÉm
      function formatDate(dateString) {
        if (!dateString) return 'N/A'; // Ho·∫∑c tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh
        const date = new Date(dateString);
        if (isNaN(date)) return 'N/A'; // Ki·ªÉm tra n·∫øu ng√†y kh√¥ng h·ª£p l·ªá
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`; // ƒê·ªãnh d·∫°ng YYYY-MM-DD
      }

      // l∆∞u b·∫£ng v√†o localStorage
      function saveTableToLocalStorage(data) {
        localStorage.setItem('tableData', JSON.stringify(data));
      }

      // H√†m hi·ªÉn th·ªã g·ª£i √Ω ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
      function showSuggestions(input, moiGiang, id) {
        const boMonTheoGiangVien = JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
        console.log('D·ªØ li·ªáu b·ªô m√¥n theo gi·∫£ng vi√™n :', boMonTheoGiangVien);

        const bangDuLieu = JSON.parse(localStorage.getItem("tableData")) || [];

        const value = input.value.toLowerCase(); // L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
        hideSuggestions(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω

        // T·∫°o th·∫ª div ch·ª©a g·ª£i √Ω
        const suggestionsContainer = document.createElement('div');
        suggestionsContainer.className = 'suggestions'; // ƒê·∫∑t class cho khung g·ª£i √Ω

        // ƒê·∫∑t v·ªã tr√≠ cho suggestionsContainer
        const { bottom, left, width } = input.getBoundingClientRect();
        suggestionsContainer.style.position = 'absolute';
        suggestionsContainer.style.top = `${bottom + window.scrollY}px`;
        suggestionsContainer.style.left = `${left + window.scrollX}px`;
        suggestionsContainer.style.width = `${width}px`;
        suggestionsContainer.style.zIndex = '1000';
        suggestionsContainer.style.maxHeight = '200px';
        suggestionsContainer.style.overflowY = 'auto';

        // Th√™m suggestionsContainer v√†o DOM
        document.body.appendChild(suggestionsContainer);

        let suggestions = [];

        // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
        const nameGvm = JSON.parse(localStorage.getItem("nameGvm")) || [];
        const nameGv = JSON.parse(localStorage.getItem("nameGv")) || [];

        // Ki·ªÉm tra gi√° tr·ªã moiGiang
        if (moiGiang) {
          suggestions = nameGvm.map(item => `${item.HoTen} - ${item.MaPhongBan}`);
        } else {
          suggestions = nameGv.map(item => `${item.TenNhanVien} - ${item.MaPhongBan}`);
        }

        // L·ªçc g·ª£i √Ω theo gi√° tr·ªã nh·∫≠p v√†o
        if (value) {
          suggestions = suggestions.filter(name => name.toLowerCase().includes(value));
        }

        // N·∫øu kh√¥ng c√≥ g·ª£i √Ω, ·∫©n container
        if (suggestions.length === 0) {
          suggestionsContainer.remove();
          return;
        }

        // T·∫°o c√°c suggestionItem cho m·ªói g·ª£i √Ω
        suggestions.forEach(name => {
          const suggestionItem = document.createElement('div'); // T·∫°o m·ªõi ph·∫ßn t·ª≠ cho g·ª£i √Ω
          suggestionItem.className = 'suggestion-item'; // ƒê·∫∑t class cho g·ª£i √Ω
          suggestionItem.textContent = name; // Thi·∫øt l·∫≠p n·ªôi dung cho g·ª£i √Ω

          // Th√™m s·ª± ki·ªán click
          suggestionItem.onclick = function () {
            // input.value = name; // ƒêi·ªÅn t√™n g·ª£i √Ω v√†o √¥ input

            // T√¨m ki·∫øm trong bangDuLieu
            const itemIndex = bangDuLieu.findIndex(item => item.id === id); // T√¨m ch·ªâ s·ªë c·ªßa item trong bangDuLieu

            // L·∫•y t√™n gi·∫£ng vi√™n t·ª´ g·ª£i √Ω ƒë√£ ch·ªçn
            const selectedName = name.split(" - ")[0]; // T√°ch t√™n ra kh·ªèi m√£ ph√≤ng ban

            // So s√°nh v·ªõi boMonTheoGiangVien
            const lecturerFound = boMonTheoGiangVien.find(lecturer => lecturer.HoTen === selectedName.trim());
            if (lecturerFound) {
              // alert('T√¨m th·∫•y gi·∫£ng vi√™n : ' + lecturerFound.HoTen); // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu t√¨m th·∫•y

              if (itemIndex !== -1) { // Ki·ªÉm tra n·∫øu c√≥ id
                // alert('T∆∞∆°ng ·ª©ng v·ªõi id trong b·∫£ng  : ' + itemIndex); // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu t√¨m th·∫•y
                // c·∫≠p nh·∫≠t b·∫£ng
                bangDuLieu[itemIndex].GiaoVienGiangDay = lecturerFound.HoTen; // C·∫≠p nh·∫≠t thu·ªôc t√≠nh BoMon c·ªßa item
                bangDuLieu[itemIndex].BoMon = lecturerFound.MonGiangDayChinh; // C·∫≠p nh·∫≠t thu·ªôc t√≠nh BoMon c·ªßa item
                console.log('D·ªØ li·ªáu v·ª´a c·∫≠p nh·∫≠t : ', bangDuLieu[itemIndex]);

                // Format l·∫°i ng√†y
                bangDuLieu.forEach(item => {
                  item.NgayBatDau = format(item.NgayBatDau); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
                  item.NgayKetThuc = format(item.NgayKetThuc); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
                });
              }

              // G·ª≠i d·ªØ li·ªáu ƒë√£ c·∫≠p nh·∫≠t l√™n server
              fetch('http://localhost:3000/check-teaching', {
                method: 'POST', // Ph∆∞∆°ng th·ª©c POST
                headers: {
                  'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
                },
                body: JSON.stringify(bangDuLieu) // Chuy·ªÉn ƒë·ªïi data ƒë√£ c·∫≠p nh·∫≠t th√†nh chu·ªói JSON
              })
                .then(response => {
                  if (!response.ok) {
                    throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
                  }
                  return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
                })
                .then(data => {
                  console.log(data.message); // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
                })
                .catch(error => {
                  console.error('C√≥ l·ªói x·∫£y ra:', error);
                });
            }

            hideSuggestions(); // ·∫®n g·ª£i √Ω sau khi ch·ªçn
            loadData(); // load l·∫°i data
            viewData(); // hi·ªÉn th·ªã b·∫£ng
          };

          suggestionsContainer.appendChild(suggestionItem); // Th√™m suggestionItem v√†o container
        });

        // ·∫®n g·ª£i √Ω khi input kh√¥ng c√≤n focus
        input.onblur = function () {
          setTimeout(() => {
            hideSuggestions();
          }, 100);
        };
      }

      // H√†m ·∫©n g·ª£i √Ω
      function hideSuggestions() {
        const existingSuggestions = document.querySelectorAll('.suggestions');
        existingSuggestions.forEach(suggestion => suggestion.remove());
      }


    });

    function calculateTotals() {
      let totalLL = 0; // Reset t·ªïng s·ªë ti·∫øt LL
      let totalQC = 0; // Reset t·ªïng s·ªë ti·∫øt QC

      const rows = document.querySelectorAll('#tableBody tr'); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng

      rows.forEach((row) => {
        // B·ªè qua c√°c h√†ng ƒëang b·ªã ·∫©n
        if (row.style.display === 'none') {
          return;
        }

        // Gi·∫£ s·ª≠ c·ªôt LL l√† c·ªôt th·ª© 2 v√† c·ªôt QuyChuan l√† c·ªôt th·ª© 3
        const LLCell = row.querySelector('td:nth-child(8)'); // L·∫•y √¥ c·ªßa c·ªôt LL
        const QuyChuanCell = row.querySelector('td:nth-child(9)'); // L·∫•y √¥ c·ªßa c·ªôt QuyChuan

        // Chuy·ªÉn ƒë·ªïi gi√° tr·ªã c·ªßa c√°c √¥ th√†nh s·ªë v√† c·ªông d·ªìn
        const LL = parseFloat(LLCell.textContent) || 0; // N·∫øu kh√¥ng ph·∫£i s·ªë, m·∫∑c ƒë·ªãnh l√† 0
        const QuyChuan = parseFloat(QuyChuanCell.textContent) || 0;

        totalLL += LL; // C·ªông d·ªìn s·ªë ti·∫øt LL
        totalQC += QuyChuan; // C·ªông d·ªìn s·ªë ti·∫øt QC
      });

      // C·∫≠p nh·∫≠t t·ªïng s·ªë ti·∫øt v√†o HTML
      document.getElementById('totalLL').textContent = totalLL;
      document.getElementById('totalQC').textContent = totalQC;
    }

    // H√†m g·ª£i √Ω b·ªô m√¥n ·ªü √¥ nh·∫≠p
    function showSuggestionsBoMon(input) {
      const value = input.value.toLowerCase(); // L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
      // alert(value);
      hideSuggestionsBoMon(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω m·ªõi

      // T·∫°o th·∫ª div ch·ª©a g·ª£i √Ω
      const suggestionsContainer = document.createElement('div');
      suggestionsContainer.className = 'suggestions'; // ƒê·∫∑t class cho khung g·ª£i √Ω

      // ƒê·∫∑t v·ªã tr√≠ cho suggestionsContainer
      const { bottom, left, width } = input.getBoundingClientRect(); // L·∫•y v·ªã tr√≠ c·ªßa input
      suggestionsContainer.style.position = 'absolute'; // ƒê·ªÉ ƒë√® l√™n b·∫£ng
      suggestionsContainer.style.top = `${bottom + window.scrollY}px`; // ƒê·∫∑t v·ªã tr√≠ ngay d∆∞·ªõi input
      suggestionsContainer.style.left = `${left + window.scrollX}px`; // CƒÉn tr√°i v·ªõi input
      suggestionsContainer.style.width = `${width}px`; // Chi·ªÅu r·ªông b·∫±ng v·ªõi input
      suggestionsContainer.style.zIndex = '1000'; // ƒê·∫£m b·∫£o lu√¥n hi·ªÉn th·ªã tr√™n c√°c th√†nh ph·∫ßn kh√°c
      suggestionsContainer.style.maxHeight = '200px'; // Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ kh√¥ng qu√° l·ªõn
      suggestionsContainer.style.overflowY = 'auto'; // Cho ph√©p cu·ªôn d·ªçc n·∫øu qu√° nhi·ªÅu g·ª£i √Ω

      // Th√™m suggestionsContainer v√†o DOM
      document.body.appendChild(suggestionsContainer); // ƒê·∫∑t suggestionsContainer v√†o body thay v√¨ cha c·ªßa input

      let suggestions = []; // Kh·ªüi t·∫°o m·∫£ng g·ª£i √Ω

      // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
      const boMon = JSON.parse(localStorage.getItem("boMon")) || [];
      console.log('Danh s√°ch b·ªô m√¥n :', boMon); // In danh s√°ch b·ªô m√¥n


      suggestions = boMon.map(item => `${item.TenBoMon} - ${item.MaBoMon}`);


      // N·∫øu ng∆∞·ªùi d√πng nh·∫≠p d·ªØ li·ªáu, l·ªçc k·∫øt qu·∫£ theo t√™n gi·∫£ng vi√™n
      if (value) {
        suggestions = suggestions.filter(name => name.toLowerCase().includes(value));
      }

      // N·∫øu kh√¥ng c√≥ g·ª£i √Ω, ·∫©n container
      if (suggestions.length === 0) {
        suggestionsContainer.remove();
        return; // K·∫øt th√∫c h√†m n·∫øu kh√¥ng c√≥ g·ª£i √Ω
      }

      // T·∫°o g·ª£i √Ω d∆∞·ªõi d·∫°ng danh s√°ch (list)
      suggestions.forEach(name => {
        const suggestionItem = document.createElement('div'); // T·∫°o ph·∫ßn t·ª≠ cho t·ª´ng g·ª£i √Ω
        suggestionItem.className = 'suggestion-item'; // ƒê·∫∑t class ƒë·ªÉ t√πy ch·ªânh giao di·ªán
        suggestionItem.textContent = name; // Hi·ªÉn th·ªã t√™n gi·∫£ng vi√™n k√®m theo khoa

        // Th√™m s·ª± ki·ªán click ƒë·ªÉ ƒëi·ªÅn t√™n v√†o √¥ input
        suggestionItem.onclick = function () {
          // Gi·∫£ s·ª≠ 'name' l√† gi√° tr·ªã g·ª£i √Ω b·∫°n nh·∫≠n ƒë∆∞·ª£c t·ª´ suggestionItem
          const name = suggestionItem.innerText; // Ho·∫∑c c√≥ th·ªÉ l√† suggestionItem.textContent
          console.log('gi√° tr·ªã nh·∫≠p : ', name);
          // T√¨m v·ªã tr√≠ c·ªßa d·∫•u "-" trong chu·ªói
          const dashIndex = name.indexOf("-");

          // N·∫øu kh√¥ng c√≥ d·∫•u "-", s·ª≠ d·ª•ng t√™n g·ª£i √Ω g·ªëc
          let processedName = name;

          if (dashIndex !== -1) {
            // L·∫•y ph·∫ßn sau d·∫•u "-" v√† lo·∫°i b·ªè kho·∫£ng tr·∫Øng
            processedName = name.slice(dashIndex + 1).trim().replace(/\s+/g, '');
          }

          // ƒêi·ªÅn t√™n g·ª£i √Ω ƒë√£ x·ª≠ l√Ω v√†o √¥ input
          input.value = processedName;
          if (input.id == 'filterBoMon') {
            filterBoMon();
          }
          hideSuggestionsBoMon(); // ·∫®n g·ª£i √Ω sau khi ch·ªçn
        };


        suggestionsContainer.appendChild(suggestionItem); // Th√™m m·ª•c v√†o danh s√°ch g·ª£i √Ω
      });

      // ·∫®n g·ª£i √Ω khi input kh√¥ng c√≤n focus
      input.onblur = function () {
        setTimeout(() => {
          hideSuggestionsBoMon();
        }, 100); // Th·ªùi gian ch·ªù ƒë·ªÉ nh·∫≠n di·ªán click
      };
    }

    // H√†m ·∫©n g·ª£i √Ω
    function hideSuggestionsBoMon() {
      const existingSuggestions = document.querySelectorAll('.suggestions');
      existingSuggestions.forEach(suggestion => suggestion.remove());
    }

    // H√†m x·ª≠ l√Ω t√¨m ki·∫øm theo t√™n b·ªô m√¥n
    function filterBoMon() {
      const input = document.getElementById('filterBoMon');
      const filter = input.value.trim().toLowerCase(); // B·ªè kho·∫£ng tr·∫Øng v√† chuy·ªÉn ch·ªØ th∆∞·ªùng
      const tableRows = document.querySelectorAll('#tableBody tr');

      tableRows.forEach(row => {
        const nameInput = row.querySelector('td:nth-child(7) input[name="bomon"]'); // L·∫•y input c√≥ name="bomon" ·ªü c·ªôt th·ª© 7
        const checkbox = row.querySelector('input[type="checkbox"]');

        if (nameInput) {
          const name = nameInput.value.toLowerCase(); // L·∫•y gi√° tr·ªã c·ªßa input c√≥ name="bomon"

          if (filter === '' || name.includes(filter)) {
            row.style.display = ''; // Hi·ªán h√†ng n·∫øu kh·ªõp ho·∫∑c filter tr·ªëng
            checkbox.disabled = false; // K√≠ch ho·∫°t checkbox
          } else {
            row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
            checkbox.disabled = true; // V√¥ hi·ªáu h√≥a checkbox
          }
        }
      });
      calculateTotals();
    }

    // H√†m x·ª≠ l√≠ : ·∫•n l∆∞u d·ªØ li·ªáu s·∫Ω c·∫≠p nh·∫≠t v√†o localStorage, db ch∆∞a thay ƒë·ªïi
    function updateLocalTable() {
      const rows = document.querySelectorAll('#tableBody tr'); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng

      // L·∫•y d·ªØ li·ªáu t·ª´ localStorage n·∫øu c√≥
      let data = localStorage.getItem('tableData');
      let localData = JSON.parse(data);

      rows.forEach((row, index) => {
        // B·ªè qua c√°c h√†ng ƒëang b·ªã ·∫©n
        if (row.style.display === 'none') {
          return;
        }

        // L·∫•y c√°c gi√° tr·ªã t·ª´ c√°c √¥ nh·∫≠p v√† checkbox
        const giaoVienGiangDayInput = row.querySelector('input[type="text"][placeholder="Nh·∫≠p t√™n gi·∫£ng vi√™n"]');
        const boMonInput = row.querySelector('input[type="text"][placeholder="Nh·∫≠p t√™n b·ªô m√¥n"]');
        const moiGiangCheckbox = row.querySelector('input[type="checkbox"][name="moigiang"]');
        const khoaCheckbox = row.querySelector('input[type="checkbox"][name="khoa"]');

        // L·∫•y gi√° tr·ªã t·ª´ c√°c √¥ nh·∫≠p li·ªáu
        const giaoVienGiangDay = giaoVienGiangDayInput ? giaoVienGiangDayInput.value : '';
        const boMon = boMonInput ? boMonInput.value : '';


        // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "Khoa" v√† "ƒê√†o T·∫°o"
        const khoaDuyet = khoaCheckbox ? khoaCheckbox.checked : false;
        const moiGiang = moiGiangCheckbox ? moiGiangCheckbox.checked : false;

        // L·∫•y gi√° tr·ªã c·ªßa c√°c √¥ ng√†y b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c
        const ngayBatDauInput = row.querySelector('input[type="date"][name="startDate"]');
        const ngayKetThucInput = row.querySelector('input[type="date"][name="endDate"]');

        const ngayBatDauValue = ngayBatDauInput ? ngayBatDauInput.value : '';
        const ngayKetThucValue = ngayKetThucInput ? ngayKetThucInput.value : '';


        // So s√°nh v√† c·∫≠p nh·∫≠t n·∫øu c·∫ßn
        const currentNgayBatDau = localData[index].NgayBatDau || '';
        const currentNgayKetThuc = localData[index].NgayKetThuc || '';

        // C·∫≠p nh·∫≠t v√†o d·ªØ li·ªáu c·ª•c b·ªô 
        if (currentNgayBatDau == '' || currentNgayBatDau != ngayBatDauValue) {
          localData[index].NgayBatDau = ngayBatDauValue; // C·∫≠p nh·∫≠t ng√†y b·∫Øt ƒë·∫ßu n·∫øu c·∫ßn
        }

        if (currentNgayKetThuc == '' || currentNgayKetThuc != ngayKetThucValue) {
          localData[index].NgayKetThuc = ngayKetThucValue; // C·∫≠p nh·∫≠t ng√†y k·∫øt th√∫c n·∫øu c·∫ßn
        }

        // C·∫≠p nh·∫≠t c√°c gi√° tr·ªã kh√°c kh√¥ng thay ƒë·ªïi
        localData[index].GiaoVienGiangDay = giaoVienGiangDay;
        localData[index].KhoaDuyet = khoaDuyet;
        localData[index].MoiGiang = moiGiang;
        localData[index].BoMon = boMon;
      });

      // C·∫≠p nh·∫≠t l·∫°i localStorage v·ªõi d·ªØ li·ªáu m·ªõi
      localStorage.setItem('tableData', JSON.stringify(localData));
      console.log('C·∫≠p nh·∫≠t v√†o tableData : ', localData)
      // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
      // alert('L∆∞u c·ª•c b·ªô th√†nh c√¥ng');
      // window.location.reload();
    }

    // x·ª≠ l√≠ t√¨m theo t√™n
    function filterByName() {
      const input = document.getElementById('filterName');
      const filter = input.value.toLowerCase();
      const tableRows = document.querySelectorAll('#tableBody tr');

      // N·∫øu √¥ t√¨m ki·∫øm tr·ªëng, hi·ªÉn th·ªã t·∫•t c·∫£ c√°c d√≤ng
      if (!filter) {
        tableRows.forEach(row => {
          row.style.display = ''; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
        });
        return;
      }

      // Ch·ªâ hi·ªán c√°c d√≤ng c√≥ t√™n gi·∫£ng vi√™n kh·ªõp v·ªõi gi√° tr·ªã t√¨m ki·∫øm
      tableRows.forEach(row => {
        const nameCell = row.querySelector('td:nth-child(3)'); // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n n·∫±m ·ªü c·ªôt th·ª© 3
        const name = nameCell.textContent.toLowerCase();

        if (name.includes(filter)) {
          row.style.display = ''; // Hi·ªán h√†ng n·∫øu kh·ªõp
        } else {
          row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
        }
      });
      calculateTotals();
    }

    // x·ª≠ l√≠ t√¨m theo l·ªõp
    function filterByClass() {
      const input = document.getElementById('filterClass');
      const filter = input.value.toLowerCase();
      const tableRows = document.querySelectorAll('#tableBody tr');

      // N·∫øu √¥ t√¨m ki·∫øm tr·ªëng, hi·ªÉn th·ªã t·∫•t c·∫£ c√°c d√≤ng
      if (!filter) {
        tableRows.forEach(row => {
          row.style.display = ''; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
        });
        return;
      }

      // Ch·ªâ hi·ªán c√°c d√≤ng c√≥ t√™n gi·∫£ng vi√™n kh·ªõp v·ªõi gi√° tr·ªã t√¨m ki·∫øm
      tableRows.forEach(row => {
        const nameCell = row.querySelector('td:nth-child(1)'); // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n n·∫±m ·ªü c·ªôt th·ª© 5
        const name = nameCell.textContent.toLowerCase();

        if (name.includes(filter)) {
          row.style.display = ''; // Hi·ªán h√†ng n·∫øu kh·ªõp
        } else {
          row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
        }
      });
      calculateTotals();
    }

    // h√†m check all
    function checkAll(type) {
      const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${type}"]`);
      const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);

      checkboxes.forEach(checkbox => {
        const row = checkbox.closest('tr');
        if (row.style.display !== 'none') { // Ki·ªÉm tra n·∫øu d√≤ng hi·ªán tr√™n m√†n h√¨nh
          checkbox.checked = checkAllCheckbox.checked; // G√°n tr·∫°ng th√°i checkbox "Check All" cho checkbox hi·ªÉn th·ªã
        }
      });
    }

    // h√†m x·ª≠ l√≠ check all
    function updateCheckAll(type) {
      const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${type}"]`);
      const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);

      // Ki·ªÉm tra n·∫øu t·∫•t c·∫£ checkbox c√° nh√¢n ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn
      const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
      checkAllCheckbox.checked = allChecked; // C·∫≠p nh·∫≠t tr·∫°ng th√°i c·ªßa checkbox "Check All"
    }

    // H√†m ƒë·∫©y d·ªØ li·ªáu l√™n server
    function submitData() {

      // g·ªçi h√†m n√†y ƒë·ªÉ l∆∞u v√†o local storage tr∆∞·ªõc
      updateLocalTable();

      // L·∫•y b·∫£ng tableData t·ª´ localStorage
      const tableData = JSON.parse(localStorage.getItem('tableData'));

      // Ki·ªÉm tra xem d·ªØ li·ªáu c√≥ t·ªìn t·∫°i hay kh√¥ng
      if (!tableData) {
        alert('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu trong localStorage.');
        return;
      }

      // Gi·∫£ s·ª≠ tableData l√† m·ªôt m·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng v√† m·ªói ƒë·ªëi t∆∞·ª£ng c√≥ c√°c thu·ªôc t√≠nh startDate v√† endDate
      tableData.forEach(item => {
        item.NgayBatDau = format(item.NgayBatDau); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
        item.NgayKetThuc = format(item.NgayKetThuc); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
      });
      // G·ª≠i d·ªØ li·ªáu l√™n server
      fetch('http://localhost:3000/check-teaching', {
        method: 'POST', // Ph∆∞∆°ng th·ª©c POST
        headers: {
          'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
        },
        body: JSON.stringify(tableData) // Chuy·ªÉn ƒë·ªïi globalData th√†nh chu·ªói JSON
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
          }
          return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
        })
        .then(data => {
          // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
          alert(data.message);
          console.log(data.message);

          // Load l·∫°i trang sau khi nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi
          //location.reload();
        })
        .catch(error => {
          console.error('C√≥ l·ªói x·∫£y ra:', error);
          alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.');
        });

    }


    // H√†m ƒë·ªãnh d·∫°ng ng√†y th√†nh chu·ªói YYYY-MM-DD
    function format(dateStr) {
      const date = new Date(dateStr);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // H√†m ki·ªÉm tra xem ng√†y c√≥ ƒë·ªãnh d·∫°ng ISO hay kh√¥ng
    function isISODate(dateStr) {
      const isoRegex = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;
      return isoRegex.test(dateStr);
    }


  </script>
  <script>
    let currentRow; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u h√†ng hi·ªán t·∫°i

    function openNoteForm(row, GhiChu, Deadline) {
      currentRow = row; // L∆∞u h√†ng hi·ªán t·∫°i
      console.log(formatInputDate(Deadline));
      document.getElementById("noteForm").style.display = "block"; // Hi·ªÉn th·ªã form
      document.getElementById("modalBackdrop").style.display = "block"; // Hi·ªÉn th·ªã n·ªÅn t·ªëi

      // Hi·ªÉn th·ªã gi√° tr·ªã ghi ch√∫ v√† h·∫°n
      document.getElementById("noteInput").value = GhiChu || ""; // Hi·ªÉn th·ªã ghi ch√∫
      document.getElementById("deadlineInput").value = formatInputDate(Deadline) || ""; // Hi·ªÉn th·ªã h·∫°n
    }


    function closeNoteForm() {
      document.getElementById("noteForm").style.display = "none"; // ·∫®n form
      document.getElementById("modalBackdrop").style.display = "none"; // ·∫®n n·ªÅn t·ªëi
    }
    window.onclick = function (event) {
      const modal = document.getElementById("noteForm");
      const modalBackdrop = document.getElementById("modalBackdrop");
      if (event.target === modalBackdrop) {
        closeNoteForm();
      }
    }
    async function saveNote() {
      const note = document.getElementById("noteInput").value;
      const deadline = document.getElementById("deadlineInput").value;

      if (currentRow) {
        const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng

        // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
        if (id) {


          // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
          try {
            const response = await fetch('/savenote', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ id, ghiChu: note, deadline }),
            });
            const result = await response.json();
            if (!result.success) {
              alert("L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message);
            } else {
              alert("C·∫≠p nh·∫≠t th√†nh c√¥ng");
            }
          } catch (error) {
            alert("L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error);
          }
        } else {
          alert("ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.");
        }
      } else {
        alert("currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.");
      }

      closeNoteForm();
    }

    async function doneNote() {
      const note = document.getElementById("noteInput").value;
      const deadline = document.getElementById("deadlineInput").value;

      if (currentRow) {
        const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng

        // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
        if (id) {


          // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
          try {
            const response = await fetch('/donenote', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ id }),
            });
            const result = await response.json();
            if (!result.success) {
              alert("L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message);
            } else {
              alert("C·∫≠p nh·∫≠t th√†nh c√¥ng");
            }
          } catch (error) {
            alert("L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error);
          }
        } else {
          alert("ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.");
        }
      } else {
        alert("currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.");
      }

      closeNoteForm();
    }


    // H√†m ƒë·ªÉ chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng ng√†y
    function formatInputDate(dateString) {
      const date = new Date(dateString);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0'); // L·∫•y th√°ng (0-11) v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë
      const day = String(date.getDate()).padStart(2, '0'); // L·∫•y ng√†y v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë

      return `${year}-${month}-${day}`; // Tr·∫£ v·ªÅ ƒë·ªãnh d·∫°ng yyyy-mm-dd cho input
    }



    // S·ª± ki·ªán click ngo√†i modal ƒë·ªÉ ƒë√≥ng modal
    window.onclick = function (event) {
      const modal = document.getElementById("noteForm");
      const modalBackdrop = document.getElementById("modalBackdrop");
      if (event.target === modalBackdrop) {
        closeNoteForm();
      }
    }
  </script>


  <!-- Ph·∫ßn ph√¢n quy·ªÅn -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {

      // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="ThongTinGD"
      const ThongTinGD = document.getElementById("ThongTinGD");

      ThongTinGD.addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

        const isKhoa = localStorage.getItem("isKhoa"); // L·∫•y role t·ª´ localStorage

        if (isKhoa == 0) { // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
          window.location.href = "/info2";
        } else {
          window.location.href = "/info";
        }
      });

      // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="Home"

      const Home = document.getElementById("Home");

      Home.addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

        const isKhoa = localStorage.getItem("isKhoa")

        if (isKhoa == 0) { // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
          window.location.href = "/maindt";
        } else {
          window.location.href = "/mainkhoa";
        }
      });

      // get all date input fields
      let dateInputs = document.querySelectorAll('[type="date"]');

      dateInputs.forEach(el => {
        // register double click event to change date input to text input and select the value
        el.addEventListener('dblclick', () => {
          el.type = "text";

          // After changing input type with JS .select() wont work as usual
          // Needs timeout fn() to make it work
          setTimeout(() => {
            el.select();
          })
        });

        // register the focusout event to reset the input back to a date input field
        el.addEventListener('focusout', () => {
          el.type = "date";
        });
      });
    });

  </script>

  <script>
    window.onload = function () {
      const TenNhanVien = localStorage.getItem("TenNhanVien"); // L·∫•y t√™n ng∆∞·ªùi d√πng t·ª´ localStorage

      let Role = localStorage.getItem("userRole");
      if (Role.toUpperCase() == 'L√ÉNH ƒê·∫†O KHOA') {
        Role = 'LƒêK';
      }

      if (TenNhanVien) {
        // Hi·ªÉn th·ªã t√™n ng∆∞·ªùi d√πng tr√™n ph·∫ßn t·ª≠ HTML
        document.querySelector('.fullname').innerText = `${TenNhanVien} - ${Role}`;
      } else {
        document.querySelector('.fullname').innerText = 'Hi, Guest'; // Hi·ªÉn th·ªã n·∫øu kh√¥ng c√≥ t√™n ng∆∞·ªùi d√πng
      }

      //document.querySelector('.role').innerText = `${Role}`;
      if (Role == 'GV') {
        document.querySelector('.luuTamThoi').style.display = 'none';
        document.querySelector('.luu').style.display = 'none';

      }
    };
  </script>

  <script>
    document.getElementById("changePasswordLink").addEventListener("click", function (event) {
      event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
      const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

      if (tenDangNhap) {
        // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
        window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(tenDangNhap)}`;
      } else {
        alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
      }
    });
  </script>
  <script>
    $(document).ready(function () {
      $('#NamHoc option[value=""]').remove();
      $('#combobox-ki option[value=""]').remove();
      $('#combobox-dot option[value=""]').remove();

      $.ajax({
        url: '/getNamHoc',
        method: 'GET',
        success: function (response) {
          if (response.success) {

            response.NamHoc.forEach(function (item) {
              console.log(item.NamHoc);
              $('#NamHoc').append(
                `<option value="${item.NamHoc}">${item.NamHoc}</option>`
              );
            });

            response.Ki.forEach(function (item) {
              console.log(item.Ki);
              $('#combobox-ki').append(
                `<option value="${item.value}">${item.Ki}</option>`
              );
            });
            response.Dot.forEach(function (item) {
              console.log(item.Dot);
              $('#combobox-dot').append(
                `<option value="${item.value}">${item.Dot}</option>`
              );
            });
          } else {
            console.error("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu nƒÉm h·ªçc:", response.message);
          }
        },
        error: function (error) {
          console.error("L·ªói khi l·∫•y d·ªØ li·ªáu nƒÉm h·ªçc:", error);
        }
      });
    });
  </script>

</body>

</html>