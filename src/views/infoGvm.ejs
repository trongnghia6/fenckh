<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Học Viện Kỹ Thuật Mật Mã</title>
  <link rel="stylesheet" href="/css/infoGvm.css" />
  <link href="/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/bootstrap/dist/bootstrap-icons-1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/bootstrap/dist/js/bootstrap.min.js">
  <style>
    .background-image {
      background: url('../../picture/OIP.jfif') no-repeat center center;
      background-size: cover;
    }

    .grid-center {
      display: grid;
      place-items: center;
    }

    .home-link {
      color: white;
      text-decoration: none;
    }

    .w-20 {
      width: 20% !important;
    }

    .header-container,
    .row-container {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      padding: 10px;
      border-bottom: 1px solid #dee2e6;
    }

    .column {
      padding: 5px;
    }
  </style>
</head>

<body>
  <header class="bg-primary text-white py-2 background-image">
    <div class="container">
      <div class="d-flex">
        <div>
          <img src="../../picture/Logo-Hoc-Vien-Ky-Thuat-Mat-Ma-ACTVN.webp" alt="Logo" class="img-fluid"
            style="height: 102.4px;">
        </div>
        <div class="text-center">
          <h1>HỌC VIỆN KỸ THUẬT MẬT MÃ</h1>
          <h2>HỆ THỐNG QUẢN LÍ THÔNG TIN CHO GIẢNG VIÊN</h2>
        </div>
      </div>
    </div>
  </header>

  <nav class="bg-info py-2">
    <div class="d-flex">
      <div class="container d-flex justify-content-center grid-center">
        <div class="btn btn-primary text-nowrap mx-1">
          <a href="index.html" class="home-link">
            <i class="bi bi-house"></i> Home
          </a>
        </div>
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle mx-1" type="button" id="dropdownMenuButton"
            data-bs-toggle="dropdown" aria-expanded="false">
            Quản lí hợp đồng
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <li><a class="dropdown-item" href="#">Xem hợp đồng</a></li>
            <li><a class="dropdown-item" href="#">Thông tin giảng viên mời</a></li>
            <li><a class="dropdown-item" href="#">Thông tin lớp giảng dạy</a></li>
            <li><a class="dropdown-item" href="#">Lương hợp đồng</a></li>
            <li><a class="dropdown-item" href="#">Lịch sử thay đổi</a></li>
          </ul>
        </div>
        <div class="dropdown">
          <button class="btn btn-primary dropdown-toggle mx-1" type="button" id="dropdownMenuButton"
            data-bs-toggle="dropdown" aria-expanded="false">
            Quản lí giảng dạy
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <li><a class="dropdown-item" href="#">Quản lí môn học</a></li>
            <li><a class="dropdown-item" href="#">Quản lí lớp học</a></li>
            <li><a class="dropdown-item" href="#">Quản lí đề thi</a></li>
            <li><a class="dropdown-item" href="#">Quản lí coi thi</a></li>
            <li><a class="dropdown-item" href="#">Quản lí chấm thi</a></li>
          </ul>
        </div>
        <a href="#" class="btn btn-primary mx-1 text-nowrap">Tin Tức</a>
      </div>
      <div class="my-2 grid-center"><a href="#" class="mx-1 justify-content-end text-nowrap">Hi, Lê Đức...</a></div>
    </div>
  </nav>

  <div class="container-fluid my-4">
    <div class="row">
      <div class="d-flex">
        <div class="bg-light mb-4 w-20">
          <h4>Chủ đề</h4>
          <ul class="nav nav-tabs list-group" id="myTab" role="tablist">
            <!-- Nội dung tab sẽ giữ nguyên -->
          </ul>
        </div>
        <div class="mx-3">
          <!-- Di chuyển nút lên trước ô tìm kiếm -->
          <button id="infoGvm" class="btn btn-primary mb-3">Xem dữ liệu giảng viên</button>
          <button onclick="submitData()" class="btn btn-primary mb-3">Cập nhật</button>

          <!-- Ô input để lọc -->
          <input type="text" id="filterName" placeholder="Nhập tên giảng viên để tìm" oninput="filterByName()"
            class="form-control mb-3" />

          <!-- Nơi render thông tin -->
          <div id="renderInfo"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="../../bootstrap-5.3.3-dist/js/jquery-3.7.1.min.js"></script>
  <script src="../../bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>

  <script>
    let globalData = []; // Biến toàn cục để lưu dữ liệu từ server

    document.getElementById('infoGvm').addEventListener('click', function () {
      // Fetch dữ liệu từ server
      fetch('http://localhost:3000/index/export')
        .then(response => response.json())
        .then(data => {
          globalData = data; // Lưu dữ liệu vào biến toàn cục
          renderTable(data); // Render bảng với dữ liệu nhận từ server
        })
        .catch(error => {
          console.error(error);
          alert('Lỗi khi lấy dữ liệu');
        });
    });

    // Hàm render bảng từ dữ liệu
    function renderTable(data) {
      const tableBody = document.getElementById('renderInfo');
      tableBody.innerHTML = ''; // Xóa nội dung cũ

      const headerContainer = document.createElement('div');
      headerContainer.classList.add('header-container');
      const headers = ['Học Phần', 'Giáo Viên Theo TKB', 'Giáo Viên Giảng Dạy', 'Số TC', 'Số Tiết Lên Lớp', 'Số Tiết Quy Chuẩn', 'Giảng Viên Mời?'];
      headers.forEach(header => {
        const headerDiv = document.createElement('div');
        headerDiv.classList.add('column');
        headerDiv.textContent = header;
        headerContainer.appendChild(headerDiv);
      });
      tableBody.appendChild(headerContainer);

      data.forEach((row) => {
        const rowContainer = document.createElement('div');
        rowContainer.classList.add('row-container');

        const lopHocPhanDiv = document.createElement('div');
        lopHocPhanDiv.textContent = row.LopHocPhan;
        lopHocPhanDiv.classList.add('column');
        rowContainer.appendChild(lopHocPhanDiv);

        const giaoVienDiv = document.createElement('div');
        giaoVienDiv.textContent = row.GiaoVien;
        giaoVienDiv.classList.add('column');
        rowContainer.appendChild(giaoVienDiv);

        const giaoVienGiangDayInput = document.createElement('input');
        giaoVienGiangDayInput.type = 'text';
        giaoVienGiangDayInput.placeholder = 'Nhập giáo viên mời';
        giaoVienGiangDayInput.classList.add('column');
        giaoVienGiangDayInput.value = row.GiaoVienGiangDay || '';
        rowContainer.appendChild(giaoVienGiangDayInput);

        const soTcDiv = document.createElement('div');
        soTcDiv.textContent = row.SoTinChi;
        soTcDiv.classList.add('column');
        rowContainer.appendChild(soTcDiv);

        const soTietLenLopDiv = document.createElement('div');
        soTietLenLopDiv.textContent = row.LL;
        soTietLenLopDiv.classList.add('column');
        rowContainer.appendChild(soTietLenLopDiv);

        const soTietQuyChuanDiv = document.createElement('div');
        soTietQuyChuanDiv.textContent = row.QuyChuan;
        soTietQuyChuanDiv.classList.add('column');
        rowContainer.appendChild(soTietQuyChuanDiv);

        const inviteCheckbox = document.createElement('input');
        inviteCheckbox.type = 'checkbox';
        inviteCheckbox.checked = row.MoiGiang || false;
        rowContainer.appendChild(inviteCheckbox);

        tableBody.appendChild(rowContainer);
      });
    }

    // Hàm lọc theo tên giảng viên
    function filterByName() {
      const filterValue = document.getElementById('filterName').value.toLowerCase();

      // Lọc dữ liệu dựa trên tên giảng viên theo TKB (hoặc giảng viên giảng dạy nếu bạn muốn)
      const filteredData = globalData.filter(row => row.GiaoVien.toLowerCase().includes(filterValue));

      // Sau đó render lại bảng với dữ liệu đã lọc
      renderTable(filteredData);
    }

    function submitData() {
      const rows = document.querySelectorAll('.row-container');

      rows.forEach((row, index) => {
        const columns = row.querySelectorAll('.column');
        const giaoVienGiangDayInput = row.querySelector('input[type="text"]');
        const inviteCheckbox = row.querySelector('input[type="checkbox"]');

        const giaoVienGiangDay = giaoVienGiangDayInput.value ? giaoVienGiangDayInput.value : "";
        const moiGiang = inviteCheckbox.checked;

        globalData[index].GiaoVienGiangDay = giaoVienGiangDay;
        globalData[index].MoiGiang = moiGiang;
      });

      console.log(globalData);
      alert("Dữ liệu đã được gửi. Kiểm tra console để xem chi tiết.");
    }
  </script>
</body>

</html>