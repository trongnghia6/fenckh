<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
    <link rel="stylesheet" href="/css/table.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/styles.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>

  <body>
    <nav class="navbar-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="/Logo-Hoc-Vien-Ky-Thuat-Mat-Ma-ACTVN.webp" alt="Logo" />
          <div class="navbar-title">
            <img src="/dongchu_banner.png" alt="banner" />
          </div>
        </a>
      </div>
    </nav>

    <!-- Ph·∫ßn d∆∞·ªõi c·ªßa navbar ch·ª©a c√°c m·ª•c n·∫±m ngang -->
    <nav class="navbar navbar-expand-lg navbar-bottom">
      <div class="" style="width: 100%">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse"
          style="width: 100%"
          id="navbarNav"
        >
          <div>
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="/admin"
                  ><i class="bi bi-house"></i
                ></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="ThongTinTK" href="/thongTinTK"
                  >Th√¥ng Tin T√†i Kho·∫£n
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" id="NhanVien" href="/nhanVien"
                  >Nh√¢n Vi√™n
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="PhongBan" href="/phongBan"
                  >Ph√≤ng Ban
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="BoMon" href="/boMon">B·ªô M√¥n </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="NamHoc" href="/namHoc">NƒÉm h·ªçc </a>
              </li>
            </ul>
          </div>

          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="/login"
                id="navbarDropdownUser"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Hi, ADMIN
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#">Th√¥ng tin c√° nh√¢n</a>
                <a class="dropdown-item" id="changePasswordLink"
                  >ƒê·ªïi m·∫≠t kh·∫©u</a
                >
                <a class="dropdown-item" href="/">ƒêƒÉng xu·∫•t</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="container my-5 box">
      <div class="d-flex justify-content-start mb-3">
        <!-- N√∫t L·ªçc m√†u gi·ªëng n√∫t Hi·ªÉn th·ªã -->

        <button id="createNv" class="btn">
          <i class="bi bi-plus-circle"></i> Th√™m Nh√¢n Vi√™n
        </button>
        <script>
          document
            .getElementById("createNv")
            .addEventListener("click", function () {
              window.location.href = "/themNhanVien";
            });
        </script>
        <input
          type="text"
          placeholder="T√¨m ki·∫øm theo t√™n nh√¢n vi√™n..."
          class="search mx-3"
          id="searchInput"
          style="height: 40px; width: 300px"
          onkeyup="searchClass()"
        />
        <input
          type="text"
          placeholder="T√¨m ki·∫øm theo m√£ ph√≤ng ban..."
          class="search mx-3"
          id="searchPB"
          style="height: 40px; width: 300px"
          onkeyup="searchPB()"
        />
        <script>
          function searchClass() {
            let input = document
              .getElementById("searchInput")
              .value.toLowerCase();
            let table = document.getElementById("nhanVienTable");
            let rows = table.getElementsByTagName("tr");

            let currentGroup = null;
            let groupVisible = false;

            for (let i = 1; i < rows.length; i++) {
              // B·∫Øt ƒë·∫ßu t·ª´ 1 ƒë·ªÉ b·ªè qua h√†ng ti√™u ƒë·ªÅ
              let row = rows[i];

              if (row.classList.contains("nhanVien")) {
                // ƒê√¢y l√† h√†ng ƒë·∫ßu ti√™n c·ªßa m·ªôt nh√≥m gi·∫£ng vi√™n m·ªõi
                if (currentGroup) {
                  // ·∫®n/hi·ªán nh√≥m tr∆∞·ªõc ƒë√≥ d·ª±a tr√™n k·∫øt qu·∫£ t√¨m ki·∫øm
                  setGroupVisibility(currentGroup, groupVisible);
                }

                currentGroup = [];
                groupVisible = false;
              }

              currentGroup.push(row);

              let teacherNameCell = row.cells[2]; // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n ·ªü c·ªôt th·ª© 2
              if (teacherNameCell) {
                let teacherName = teacherNameCell.textContent.toLowerCase();
                if (teacherName.includes(input)) {
                  groupVisible = true;
                }
              }
            }

            // X·ª≠ l√Ω nh√≥m cu·ªëi c√πng
            if (currentGroup) {
              setGroupVisibility(currentGroup, groupVisible);
            }
          }
          function searchPB() {
            let input = document.getElementById("searchPB").value.toLowerCase();
            let table = document.getElementById("nhanVienTable");
            let rows = table.getElementsByTagName("tr");

            let currentGroup = null;
            let groupVisible = false;

            for (let i = 1; i < rows.length; i++) {
              // B·∫Øt ƒë·∫ßu t·ª´ 1 ƒë·ªÉ b·ªè qua h√†ng ti√™u ƒë·ªÅ
              let row = rows[i];

              if (row.classList.contains("nhanVien")) {
                // ƒê√¢y l√† h√†ng ƒë·∫ßu ti√™n c·ªßa m·ªôt nh√≥m gi·∫£ng vi√™n m·ªõi
                if (currentGroup) {
                  // ·∫®n/hi·ªán nh√≥m tr∆∞·ªõc ƒë√≥ d·ª±a tr√™n k·∫øt qu·∫£ t√¨m ki·∫øm
                  setGroupVisibility(currentGroup, groupVisible);
                }

                currentGroup = [];
                groupVisible = false;
              }

              currentGroup.push(row);

              let teacherNameCell = row.cells[4]; // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n ·ªü c·ªôt th·ª© 2
              if (teacherNameCell) {
                let teacherName = teacherNameCell.textContent.toLowerCase();
                if (teacherName.includes(input)) {
                  groupVisible = true;
                }
              }
            }

            // X·ª≠ l√Ω nh√≥m cu·ªëi c√πng
            if (currentGroup) {
              setGroupVisibility(currentGroup, groupVisible);
            }
          }

          function setGroupVisibility(group, visible) {
            group.forEach((row) => {
              row.style.display = visible ? "" : "none";
            });
          }
        </script>
      </div>
      <div class="pb-3">
        <table id="nhanVienTable" class="table table-bordered">
          <thead>
            <tr>
              <th>STT</th>
              <th>M√£ nh√¢n vi√™n</th>
              <th>T√™n nh√¢n vi√™n</th>
              <th>Gi·ªõi t√≠nh</th>
              <th>M√£ Ph√≤ng ban</th>
              <th>T√™n ph√≤ng ban</th>
              <th>Ch·ª©c v·ª•</th>
              <th>M√¥n gi·∫£ng d·∫°y ch√≠nh</th>
              <th>ƒêi·ªán tho·∫°i</th>
              <th>CCCD</th>
              <th>Ng√†y c·∫•p CCCD</th>
              <th>N∆°i c·∫•p CCCD</th>
              <th>H·ªçc v·ªã</th>
              <th>T√™n ƒëƒÉng nh·∫≠p</th>
              <th>M·∫≠t kh·∫©u</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody class="nhanVien" id="data-table-body">
            <% if (nhanvienLists && nhanvienLists.length > 0) { %> <% for (var i
            = 0; i < nhanvienLists.length; i++) { %>
            <tr class="nhanVien">
              <td><%= i+1 %></td>
              <td><%= nhanvienLists[i].MaNhanVien %></td>
              <!-- Hi·ªÉn th·ªã t√™n t√†i kho·∫£n -->
              <td><%= nhanvienLists[i].TenNhanVien %></td>
              <!-- Hi·ªÉn th·ªã email -->
              <td><%= nhanvienLists[i].GioiTinh %></td>
              <td><%= nhanvienLists[i].MaPhongBan %></td>
              <td><%= nhanvienLists[i].TenPhongBan %></td>
              <td><%= nhanvienLists[i].ChucVu %></td>
              <td><%= nhanvienLists[i].MonGiangDayChinh %></td>
              <td><%= nhanvienLists[i].DienThoai %></td>
              <td><%= nhanvienLists[i].CCCD %></td>
              <% const options = { year: 'numeric', month: '2-digit', day:
              '2-digit' }; %>
              <td>
                <%= nhanvienLists[i].NgayCapCCCD ? new
                Date(nhanvienLists[i].NgayCapCCCD).toLocaleDateString('vi-VN',
                options) : '' %>
              </td>
              <td><%= nhanvienLists[i].NoiCapCCCD %></td>
              <td><%= nhanvienLists[i].HocVi %></td>
              <td><%= nhanvienLists[i].TenDangNhap %></td>
              <td><%= nhanvienLists[i].MatKhau %></td>
              <td class="d-flex" style="border: none">
                <button
                  class="action-button edit"
                  onclick="editNV(this, <%= parseInt(nhanvienLists[i].id_User) - 1 %>)"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="action-button view"
                  onclick="viewNV(this, <%= parseInt(nhanvienLists[i].id_User) - 1 %>)"
                >
                  üëÅÔ∏è
                </button>
              </td>
            </tr>
            <% } %> <% } else { %>
            <tr>
              <td colspan="3">Kh√¥ng c√≥ t√†i kho·∫£n n√†o.</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Script x·ª≠ l√Ω checkbox -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const selectAllCheckbox = document.getElementById("selectAll");
        const rowCheckboxes = document.querySelectorAll(".row-checkbox");

        selectAllCheckbox.addEventListener("change", function () {
          rowCheckboxes.forEach((checkbox) => {
            checkbox.checked = selectAllCheckbox.checked;
          });
        });

        rowCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            selectAllCheckbox.checked = Array.from(rowCheckboxes).every(
              (cb) => cb.checked
            );
          });
        });
      });
    </script>
    <script>
      function editNV(button, index) {
        hre = "/updateNV/" + index;
        window.location.href = hre;
      }
      function viewNV(button, index) {
        hre = "/viewNV/" + index;
        window.location.href = hre;
      }
    </script>
    <script>
      document
        .getElementById("changePasswordLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

          if (tenDangNhap) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
            window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(
              tenDangNhap
            )}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
          }
        });
    </script>
  </body>
</html>
